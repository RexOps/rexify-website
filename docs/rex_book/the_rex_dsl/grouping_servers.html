<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta content="text/html; charset=utf-8" http-equiv="content-type">

      <title>Grouping servers</title>

      <meta content="width=1024, initial-scale=0.5" name="viewport">
      <link href="/public/images/skin/rexify.org/favicon.png" rel="shortcut icon">
      <link href="/public/css/skin/rexify.org/hs/tomorrow.css" rel="stylesheet">
      <link charset="utf-8" href="/public/css/skin/rexify.org/bootstrap.min.css?20130325" media="screen" rel="stylesheet" type="text/css">
      <link charset="utf-8" href="/public/css/skin/rexify.org/default.css?20140412" media="screen" rel="stylesheet" type="text/css">
      <script src="/public/js/skin/rexify.org/highlight.pack.js"></script>
      <meta content="" name="description">
      <meta content="" name="keywords">

   </head>
   <body>

      <div id="page">

         <div class="top_div" id="top-div">
            <h1>(R)?ex <small>Deployment &amp; Configuration Management</small></h1>
            <div id="nav-div">
               
<div class="nav_links">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/get/index.html">Get Rex</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/care/index.html">Care</a>
      <ul class="dropdown_menu dropdown_care">
          <li><a href="/care/help__r__ex.html">Help (R)?ex</a></li>
          <li><a href="/care/help_people_in_need.html">Help people</a></li>
      </ul>
    </li>
    <li><a href="/support/index.html">Support</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/docs/index.html">Docs</a>
      <ul class="dropdown_menu dropdown_docs">
          <li><a href="/docs/faq/index.html">FAQ</a></li>
          <li><a href="/docs/guides/index.html">Guides</a></li>
          <li><a href="/docs/rex_book/index.html">Rex Book (work in progress)</a></li>
          <li><a href="/docs/other/index.html">Other</a></li>
          <li><a href="/docs/release_notes/index.html">Release notes</a></li>
            <li class="divider"></li>
          <li><a href="https://metacpan.org/release/Rex">API</a></li>
      </ul>
    </li>
  </ul>
</div>

            </div>
            </div>
         </div>

         <div id="widgets_container">
            <div id="widgets">

               <h2>Conferences</h2>
                 <div class="news_widget">
                    <div class="news_date">2016-06-21</div>
                    <div class="news_content"><a href="http://preaction.me/">Doug Bell (preaction)</a> from <a href="http://chicago.pm.org/">Chicago.pm</a> will give an <a href="http://www.yapcna.org/yn2016/talk/6549">Introduction to Rex</a> talk at <a href="http://www.yapcna.org/yn2016/">YAPC::NA 2016</a>.</div>
                 </div>

               <h2>Need Help?</h2>
               <p>Rex is a pure open source project, you can find community support in the following places:</p>
               <ul>
                  <li>IRC: <a href="irc://irc.freenode.net/rex">#rex on irc.freenode.net</a></li>
                  <li>Groups: <a href="https://groups.google.com/group/rex-users/">Rex Users</a></li>
                  <li>Serverfault: <a href="http://serverfault.com/questions/tagged/rex">Tag with <i>rex</i></a></li>
                  <li>Issues: <a href="https://github.com/RexOps/Rex/issues">on GitHub</a></li>
                  <li>Feature: you miss a <a href="/feature.html">feature</a>?</li>
               </ul>
               <p><a href="/support/index.html">Professional support</a> is also available.</p>
            </div>
         </div> <!-- widgets -->

         <div id="content_container">
            <div id="content">
              




<p>
» <a href="/index.html">Home</a>
» <a href="/docs/index.html">Docs</a>
» <a href="/docs/rex_book/index.html">Rex book</a>
» <a href="/docs/rex_book/the_rex_dsl/index.html">The rex dsl</a>
» <a href="/docs/rex_book/the_rex_dsl/grouping_servers.html">Grouping servers</a>
</p>

              
              <h1>Grouping servers</h1>
              <p>Rex offers you a powerfull way to group your servers. The simplest way to use groups is to just define a group name and add all your desired servers to this group.</p>

<pre><code>group frontends =&gt; &quot;frontend01&quot;, &quot;frontend02&quot;, &quot;frontend03&quot;;
group backends =&gt; &quot;backend01&quot;, &quot;backend02&quot;;
</code></pre>

<p>Rex offers also a simple notation to define server ranges, so that you don&#39;t need to type so much.</p>

<pre><code>group frontends =&gt; &quot;frontend[01..03]&quot;;
group backends =&gt; &quot;backend[01..02]&quot;;
</code></pre>

<p>This notation will just expand to frontend01, frontend02 and frontend03 for the frontends group and to backend01 and backend02 for the backends group.</p>

<p>Custom parameters for servers are possible with a slightly enhanced syntax since version 0.47:</p>

<pre><code>group frontends =&gt;
   &quot;frontend01&quot; =&gt; { user =&gt; &quot;bob&quot; },
   &quot;frontend02&quot; =&gt; { user =&gt; &quot;alice&quot; },
   &quot;frontend03&quot;;
</code></pre>

<p>Because the Rexfile is a Perl script you can just use more advanced things like querying a database, ldap or your dns.</p>

<p>To add your groups to the tasks you have to use the group option within the task generation.</p>

<pre><code>task &quot;mytask&quot;, group =&gt; &quot;mygroup&quot;, sub {
   # do something
};
</code></pre>

<p>If you need to define multiple groups for a task, you can just use an array.</p>

<pre><code>task &quot;mytask&quot;, group =&gt; [&quot;mygroup&quot;, &quot;mygroup2&quot;], sub {
   # do something
};
</code></pre>

<h2 id="usinganinifiletodefineservergroups">Using an INI file to define server groups</h2>

<p>Rex offers a simple way to query ini files for group creation. To use ini files you have to use the Rex::Group::Lookup::INI module.</p>

<pre><code>use Rex -feature =&gt; [&#39;1.0&#39;];
use Rex::Group::Lookup::INI;

groups_file &quot;/path/to/your/file.ini&quot;;
</code></pre>

<p>Rex expects the following format inside your INI file.</p>

<pre><code>[frontends]
frontend01
frontend02
frontend03

[backends]
backend01
backend02
</code></pre>

<p>Rex also offers a little bit advanced functions for the ini file. You can define custom parameters for each server or include groups inside groups.</p>

<pre><code>[frontends]
frontend01
frontend02 user=root password=f00bar auth_type=pass maintenance=1
frontend03

[backends]
backend01
backend02

[all]
@frontends
@backends
</code></pre>

<p>These additional options (in this example maintenance can be queried with the option method from the connection object.</p>

<pre><code>task &quot;prepare&quot;, group =&gt; &quot;frontends&quot;, sub {
   if(connection-&gt;server-&gt;option(&quot;maintenance&quot;)) {
      say &quot;This server is in maintenance mode, so i&#39;m going to stop all services&quot;;
      service [&quot;apache2&quot;, &quot;postfix&quot;] =&gt; &quot;stop&quot;;
   }
};
</code></pre>

<h2 id="queringadatabasetodefineservergroups">Quering a database to define server groups</h2>

<p>If you want to get your server groups right out of an existing database you can use DBI to connect to your database server. In this example you will learn how to connect to a MySQL database and to get the hosts out of a table.</p>

<pre><code>use Rex -feature =&gt; [&#39;1.0&#39;];
use DBI;

my $username = &quot;dbuser&quot;;
my $password = &quot;dbpassword&quot;;
my $database = &quot;hostdb&quot;;
my $hostname = &quot;mysql.intern.lan&quot;;
my $port     = 3306;
my $dsn      = &quot;DBI:mysql:database=$database;host=$hostname;port=$port&quot;;
my $dbh      = DBI-&gt;connect($username, $password);

my $sth      = $dbh-&gt;prepare(&quot;SELECT * FROM hostlist WHERE enabled=1&quot;);

my %server_group = ();
while(my $row = $sth-&gt;fetchrow_hashref) {
   my $group_name  = $row-&gt;{server_group};
   my $server_name = $row-&gt;{server_name};
   push @{ $server_group{ $group_name } }, $server_name;
}

map {
   group $_ =&gt; @{ $server_group{$_} };
} keys %server_group;
</code></pre>

<p>This example expects the following column names:</p>

<ul>
<li>server_group</li>
<li>server_name</li>
</ul>

<h2 id="creatingcustomgroups">Creating custom groups</h2>

<p>If there is no built-in function that fits your needs for group creation, you can do it all by yourself. Because the Rexfile is just a plain perl script and the group command is just a perl function that expects the group name as first parameter, and uses all other parameters for the servers, you can create your own function.</p>

<pre><code>my @list = (&quot;some&quot;, &quot;list&quot;, &quot;entries&quot;);
group mygroup =&gt; grep { /list/ } @list;
group myserver =&gt; map {&quot;s$_.domain.com&quot;} qw(1 3 7);
</code></pre>



            </div>
         </div> <!-- content -->

       <!-- page -->


   <div class="clearfix"></div>
   <div class="bottom_bar">
      <a href="https://groups.google.com/group/rex-users/">Google Group</a> / <a href="http://twitter.com/RexOps">Twitter</a> / <a href="https://github.com/RexOps/Rex">GitHub</a> / <a href="http://www.freelists.org/list/rex-users">Mailinglist</a> / <a href="irc://irc.freenode.net/rex">irc.freenode.net #rex</a><span id="syntax_high" style="display: none;"> / <a href="#" id="link_syntax_high">Enable Syntax Highlighting</a></span>   -.ô.-   <a href="http://www.disclaimer.de/disclaimer.htm" target="_blank">Disclaimer</a>
   </div>

<script>
  hljs.tabReplace = '    ';
//  hljs.initHighlighting();
  hljs.initHighlightingOnLoad();
</script>


   </body>

</html>
