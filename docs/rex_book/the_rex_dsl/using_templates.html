<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html prefix="og: http://ogp.me/ns#" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta content="text/html; charset=utf-8" http-equiv="content-type">

      <title>Using templates</title>

      <meta content="Using templates" property="og:title">
      <meta content="website" property="og:type">
      <meta content="https://rexify.org/docs/rex_book/the_rex_dsl/using_templates.html" property="og:url">
      <meta content="https://rexify.org/public/images/skin/rexify.org/open_graph.png" property="og:image">

      <meta content="width=1024, initial-scale=0.5" name="viewport">
      <link href="/public/images/skin/rexify.org/favicon.png" rel="shortcut icon">
      <link href="/public/css/skin/rexify.org/hs/tomorrow.css" rel="stylesheet">
      <link charset="utf-8" href="/public/css/skin/rexify.org/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css">
      <link charset="utf-8" href="/public/css/skin/rexify.org/default.css" media="screen" rel="stylesheet" type="text/css">
      <meta content="" name="description">
      <meta content="" name="keywords">

   </head>
   <body>

      <div id="page">

         <div class="top_div" id="top-div">
            <h1>(R)?ex <small>the friendly automation framework</small></h1>
            <div id="nav-div">
               
<div class="nav_links">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/get/index.html">Get Rex</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/care/index.html">Care</a>
      <ul class="dropdown_menu dropdown_care">
          <li><a href="/care/help__r__ex.html">Help (R)?ex</a></li>
          <li><a href="/care/help_people_in_need.html">Help people</a></li>
      </ul>
    </li>
    <li><a href="/support/index.html">Support</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/docs/index.html">Docs</a>
      <ul class="dropdown_menu dropdown_docs">
          <li><a href="/docs/faq/index.html">FAQ</a></li>
          <li><a href="/docs/guides/index.html">Guides</a></li>
          <li><a href="/docs/rex_book/index.html">Rex Book (work in progress)</a></li>
          <li><a href="/docs/release_notes/index.html">Release notes</a></li>
            <li class="divider"></li>
          <li><a href="https://metacpan.org/release/Rex">API</a></li>
      </ul>
    </li>
  </ul>
</div>

            </div>
            </div>
         </div>

         <div id="widgets_container">
            <div id="widgets">
               <h2>News</h2>
                   <p><b>2020-12-05</b><br>
                     <a href="/blog/2020/12/05/rex-1.13.2.html">Rex-1.13.2</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.13.2.html">Rex-1.13.2 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.13.2">available on CPAN</a>. It contains only documentation updates, mostly for the built-in template capabilities, but also fixes a few typos.</p>

                   <p><b>2020-11-05</b><br>
                     <a href="/blog/2020/11/05/rex-1.13.1.html">Rex-1.13.1</a></p><p>
                   </p><p></p><p><a href="https://github.com/RexOps/Rex/commit/cabbc6a8aa9eb2c0d9d3fc2439be51924edc3ff8">Happy 10th birthday, Rex!</a></p>

<p>The <a href="/docs/release_notes/1.13.1.html">Rex-1.13.1 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.13.1">available on CPAN</a>. It is focusing on CMDB bugfixes and documentation, while also fixing a missing feature flag. Upgrade is recommended for all users.</p>

                   <p><b>2020-10-05</b><br>
                     <a href="/blog/2020/10/05/rex-1.13.0.html">Rex-1.13.0</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.13.0.html">Rex-1.13.0 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.13.0">available on CPAN</a>. It adds <code>on_no_change</code> hooks for file management commands to trigger further actions when files are left unchanged. Upgrade is recommended for all users.</p>

                   <p><b>2020-09-05</b><br>
                     <a href="/blog/2020/09/05/rex-1.12.2.html">Rex-1.12.2</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.12.2.html">Rex-1.12.2 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.12.2">available on CPAN</a>. It fixes various regressions, as well as bugs around file management. Upgrade is highly recommended for all users.</p>

                   <p><b>2020-08-05</b><br>
                     <a href="/blog/2020/08/05/rex-1.12.1.html">Rex-1.12.1</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.12.1.html">Rex-1.12.1 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.12.1">available on CPAN</a>. It adds documentation for feature flags, and fixes a release packaging issue.</p>


               <h2>Events</h2>
                   <p><b>2021-03-08</b><br>
                     <a href="/blog/2021/03/04/learn_automation_using_rex.html">Learning automation using Rex</a></p><p>
                   </p><p></p><p>Ferenc Erki (FErki) will be the guest of <a href="https://www.linkedin.com/in/szabgab/">Gábor Szabó</a> on the next Code Maven live stream to learn about automation using Rex. Register for the free event via <a href="https://code-maven.com/automation-with-rex">Code Maven</a> or <a href="https://www.meetup.com/Code-Mavens/events/276730377/">Meetup</a>, and join the discussion!</p>

                   <p><b>2020-03-05</b><br>
                     <a href="/blog/2020/03/05/unexpected_use_cases_with_rex.html">Unexpected use cases with Rex</a></p><p>
                   </p><p></p><p><a href="https://act.yapc.eu/gpw2020/talk/7699">Unexpected use cases with Rex</a> at the <a href="https://act.yapc.eu/gpw2020/index.html">22nd German Perl/Raku Workshop 2020</a> in Erlangen by Ferenc Erki (FErki).</p>

                   <p><b>2019-11-09</b><br>
                     <a href="/blog/2019/11/09/rex_and_friends_2019.html">Rex &amp; Friends</a></p><p>
                   </p><p></p><p><a href="https://friends.barcelona.pm/2019/#/talks/rex-and-friends">Rex &amp; Friends</a> talk at the <a href="https://friends.barcelona.pm">Barcelona Perl &amp; Friends 2019</a> by Ferenc Erki (FErki).</p>


            </div>
         </div> <!-- widgets -->

         <div id="content_container">
            <div id="content">
                




<p>
» <a href="/index.html">Home</a>
» <a href="/docs/index.html">Docs</a>
» <a href="/docs/rex_book/index.html">Rex book</a>
» <a href="/docs/rex_book/the_rex_dsl/index.html">The rex dsl</a>
» <a href="/docs/rex_book/the_rex_dsl/using_templates.html">Using templates</a>
</p>

              
              <h1>Using templates</h1>
              <p>A template is a text file containing special variables or perl code inside it. So with this technique you can generate dynamic configuration files. For example if you want to configure apache only to listen on a special ethernet device (eth0 for example) templates are what you need.</p>

<p>The default template engine is a special Rex template engine. The syntax is a bit like php or erb. But you can use any template engine you want. Just browse cpan and find one you like.</p>

<p>For example:</p>

<pre><code>Hello &lt;%= $name %&gt;!
</code></pre>

<p>If $name contains &quot;World&quot; this template would result in the string Hello World!. This is very useful if you have to maintain a large set of nearly identical configuration files.</p>

<h2 id="workingwithatemplate">Working with a template</h2>

<p>First you have to create it</p>

<pre><code>$ mkdir files
$ vim files/my.cnf.tpl

[mysqld]
datadir                 = /var/lib/mysql
socket                  = /var/run/mysqld/mysqld.sock
user                    = mysql
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links          = 0
datadir                 = /var/lib/mysql
tmpdir                  = /tmp
skip-external-locking
max_allowed_packet      = 64M
thread_stack            = 192K
max_connections         = &lt;%= exists $conf-&gt;{&quot;max_connections&quot;} ? $conf-&gt;{&quot;max_connections&quot;} : &quot;1000&quot; %&gt;

max_connect_errors      = 1000
table_cache             = &lt;%= exists $conf-&gt;{&quot;table_cache&quot;} ? $conf-&gt;{&quot;table_cache&quot;} : &quot;5000&quot; %&gt;
table_open_cache        = &lt;%= exists $conf-&gt;{&quot;table_open_cache&quot;} ? $conf-&gt;{&quot;table_open_cache&quot;} : &quot;5000&quot; %&gt;
thread_concurrency      = 10

#
# ... and more ...
#
</code></pre>

<p>Than you can reference on it from within your Rexfile.</p>

<pre><code class="hljs"><span class="hljs-keyword">use</span> Rex -feature =&gt; [&#39;<span class="hljs-string">1.0</span>&#39;];

user &quot;<span class="hljs-string">root</span>&quot;;
key_auth;

group databases =&gt; &quot;<span class="hljs-string">mydb01</span>&quot;, &quot;<span class="hljs-string">mydb02</span>&quot;;

task &quot;<span class="hljs-string">prepare_databases</span>&quot;,
  group =&gt; &quot;<span class="hljs-string">databases</span>&quot;,
  <span class="hljs-keyword">sub </span>{
    file &quot;<span class="hljs-string">/etc/my.cnf</span>&quot;,
      owner   =&gt; &quot;<span class="hljs-string">root</span>&quot;,
      group   =&gt; &quot;<span class="hljs-string">root</span>&quot;,
      mode    =&gt; &quot;<span class="hljs-string">644</span>&quot;,
      content =&gt; template(
        &quot;<span class="hljs-string">files/my.cnf.tpl</span>&quot;,
        conf =&gt; {
            max_connections =&gt; &quot;<span class="hljs-string">500</span>&quot;,
            table_cache     =&gt; &quot;<span class="hljs-string">2500</span>&quot;,
        }
      );
  };</code></pre>

<h2 id="inlinetemplates">Inline Templates</h2>

<p>When you want to deliver a rexfile that includes the templates, you can use inline templates. To use this feature, you have to use the __DATA__ section of your rexfile. You can also define several templates in that section:</p>

<h3 id="usingasingleinlinetemplate">Using a single inline template</h3>

<pre><code class="hljs"><span class="hljs-keyword">use</span> Rex -feature =&gt; [&#39;<span class="hljs-string">1.0</span>&#39;];

task tempfiles =&gt; <span class="hljs-keyword">sub </span>{
    file &#39;<span class="hljs-string">/tmp/test.txt</span>&#39; =&gt; content =&gt; template(
        &#39;<span class="hljs-string">@test</span>&#39;,
        test =&gt; {
            author =&gt; &#39;<span class="hljs-string">reneeb</span>&#39;,
            target =&gt; &#39;<span class="hljs-string">rex</span>&#39;,
        },
      ),
      <span class="hljs-function">chmod</span> =&gt; <span class="hljs-number">644</span>,
      ;
};

<span class="hljs-keyword">__DATA__</span>
@test
This is a test written by &lt;%= $test-&gt;{author} %&gt;
for a project called &lt;%= $test-&gt;{target} %&gt;
@end</code></pre>

<p>The <code>__DATA__</code> section is the last section of the Rexfile. The first parameter of the template method call gets the name of the inline template. Note that names of inline templates begin with <code>@</code>.</p>

<p>Rex knows that it has to look up the template in the <code>__DATA__</code> section of the file where template was called. Within the section the template starts with its name (here: <code>@test</code>) and then follows the template text.</p>

<h3 id="usingmultipleinlinetemplates">Using multiple inline templates</h3>

<pre><code class="hljs">use Rex -feature =&gt; [&#39;<span class="hljs-string">1.0</span>&#39;];
task tempfiles   =&gt; <span class="hljs-keyword">sub </span>{
    file &#39;<span class="hljs-string">/tmp/test.txt</span>&#39; =&gt; content =&gt; template(
        &#39;<span class="hljs-string">@test</span>&#39;,
        test =&gt; {
            author =&gt; &#39;<span class="hljs-string">reneeb</span>&#39;,
            target =&gt; &#39;<span class="hljs-string">rex</span>&#39;,
        },
      ),
      <span class="hljs-function">chmod</span> =&gt; <span class="hljs-number">644</span>,
      ;

    file &#39;<span class="hljs-string">/tmp/rex.txt</span>&#39; =&gt; content =&gt; template(
        &#39;<span class="hljs-string">@rex</span>&#39;,
        test =&gt; {
            author =&gt; &#39;<span class="hljs-string">krimdomu</span>&#39;,
            target =&gt; &#39;<span class="hljs-string">rex</span>&#39;,
        },
      ),
      <span class="hljs-function">chmod</span> =&gt; <span class="hljs-number">644</span>,
      ;
};

<span class="hljs-keyword">__DATA__</span>
@test
This is a test written by &lt;%= $test-&gt;{author} %&gt;
for a project called &lt;%= $test-&gt;{target} %&gt;
@end

@rex
Contribution by &lt;%= $test-&gt;{author} %&gt;
for a project called &lt;%= $test-&gt;{target} %&gt;
@end</code></pre>

<p>Now we just look at the <code>__DATA__</code> section: You notice the token <code>@end</code>. This is used to separate the templates. At the end of each template (except for the last one) this token is needed. Otherwise Rex will use everything up to the first <code>@end</code> as the template which is most likely too much.</p>



            </div>
         </div> <!-- content -->

       <!-- page -->


   <div class="clearfix"></div>
   <div class="bottom_bar">
      <p>Proudly powered by <a href="http://preaction.me/statocles/">Statocles</a></p>
      <a href="https://github.com/RexOps/Rex">GitHub</a> / <a href="https://webchat.freenode.net/#rex">IRC</a> / <a href="http://twitter.com/RexOps">Twitter</a> / <a href="https://groups.google.com/group/rex-users/">Google Groups</a> / <a href="https://stackshare.io/rex">StackShare</a> / <a href="http://www.freelists.org/list/rex-users">Mailing list</a> / <a href="http://serverfault.com/questions/tagged/rex">Server Fault</a>   -.ô.-   <a href="http://www.disclaimer.de/disclaimer.htm" target="_blank">Disclaimer</a>
   </div>

   </body>

</html>
