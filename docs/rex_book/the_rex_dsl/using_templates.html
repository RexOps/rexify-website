<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta content="text/html; charset=utf-8" http-equiv="content-type">

      <title>Using templates</title>

      <meta content="width=1024, initial-scale=0.5" name="viewport">
      <link href="/rexify-website/public/images/skin/rexify.org/favicon.png" rel="shortcut icon">
      <link href="/rexify-website/public/css/skin/rexify.org/hs/tomorrow.css" rel="stylesheet">
      <link charset="utf-8" href="/rexify-website/public/css/skin/rexify.org/bootstrap.min.css?20130325" media="screen" rel="stylesheet" type="text/css">
      <link charset="utf-8" href="/rexify-website/public/css/skin/rexify.org/default.css?20140412" media="screen" rel="stylesheet" type="text/css">
      <script src="/rexify-website/public/js/skin/rexify.org/highlight.pack.js"></script>
      <meta content="" name="description">
      <meta content="" name="keywords">

   </head>
   <body>

      <div id="page">

         <div class="top_div" id="top-div">
            <h1>(R)?ex <small>Deployment &amp; Configuration Management</small></h1>
            <div id="nav-div">
               
<div class="nav_links">
  <ul>
    <li><a href="/rexify-website/">Home</a></li>
    <li><a href="/rexify-website/get/index.html">Get Rex</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/rexify-website/care/index.html" title="care">Care</a>
      <ul class="dropdown_menu dropdown_care">
          <li><a href="/rexify-website/care/help__r__ex.html">Help (R)?ex</a></li>
          <li><a href="/rexify-website/care/help_people_in_need.html">Help people</a></li>
      </ul>
    </li>
    <li><a href="/rexify-website/support/index.html">Support</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/rexify-website/docs/index.html" title="docs">Docs</a>
      <ul class="dropdown_menu dropdown_docs">
          <li><a href="/rexify-website/docs/faq/index.html">FAQ</a></li>
          <li><a href="/rexify-website/docs/guides/index.html">Guides</a></li>
          <li><a href="/rexify-website/docs/rex_book/index.html">Rex Book (work in progress)</a></li>
          <li><a href="/rexify-website/docs/other/index.html">Other</a></li>
          <li><a href="/rexify-website/docs/release_notes/index.html">Release notes</a></li>
            <li class="divider"></li>
          <li><a href="https://metacpan.org/release/Rex">API</a></li>
      </ul>
    </li>
  </ul>
</div>

            </div>
            </div>
         </div>

         <div id="widgets_container">
            <div id="widgets">
               <h2>Conferences</h2>
                 <div class="news_widget">
                    <div class="news_date">2016-06-21</div>
                    <div class="news_content"><a href="http://preaction.me/">Doug Bell (preaction)</a> from <a href="http://chicago.pm.org/">Chicago.pm</a> will give an <a href="http://www.yapcna.org/yn2016/talk/6549">Introduction to Rex</a> talk at <a href="http://www.yapcna.org/yn2016/">YAPC::NA 2016</a>.</div>
                 </div>

               <h2>Need Help?</h2>
               <p>Rex is a pure open source project, you can find community support in the following places:</p>
               <ul>
                  <li>IRC: <a href="irc://irc.freenode.net/rex">#rex on irc.freenode.net</a></li>
                  <li>Groups: <a href="https://groups.google.com/group/rex-users/">Rex Users</a></li>
                  <li>Serverfault: <a href="http://serverfault.com/questions/tagged/rex">Tag with <i>rex</i></a></li>
                  <li>Issues: <a href="https://github.com/RexOps/Rex/issues">on GitHub</a></li>
                  <li>Feature: you miss a <a href="/rexify-website/feature.html">feature</a>?</li>
               </ul>
               <p><a href="/rexify-website/support/index.html">Professional support</a> is also available.</p>
            </div>
         </div> <!-- widgets -->

         <div id="content_container">
            <div id="content">
              




<p>
» <a href="/rexify-website/index.html">Home</a>
» <a href="/rexify-website/docs/index.html">Docs</a>
» <a href="/rexify-website/docs/rex_book/index.html">Rex book</a>
» <a href="/rexify-website/docs/rex_book/the_rex_dsl/index.html">The rex dsl</a>
» <a href="/rexify-website/docs/rex_book/the_rex_dsl/using_templates.html">Using templates</a>
</p>

              
              <h1>Using templates</h1>
              <p>A template is a text file containing special variables or perl code inside it. So with this technique you can generate dynamic configuration files. For example if you want to configure apache only to listen on a special ethernet device (eth0 for example) templates are what you need.</p>

<p>The default template engine is a special Rex template engine. The syntax is a bit like php or erb. But you can use any template engine you want. Just browse cpan and find one you like.</p>

<p>For example:</p>

<pre><code>Hello &lt;%= $name %&gt;!
</code></pre>

<p>If $name contains &quot;World&quot; this template would result in the string Hello World!. This is very usefull if you have to maintain a large set of nearly identical configuration files.</p>

<h2 id="workingwithatemplate">Working with a template</h2>

<p>First you have to create it</p>

<pre><code>$ mkdir files
$ vim files/my.cnf.tpl

[mysqld]
datadir                 = /var/lib/mysql
socket                  = /var/run/mysqld/mysqld.sock
user                    = mysql
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links          = 0
datadir                 = /var/lib/mysql
tmpdir                  = /tmp
skip-external-locking
max_allowed_packet      = 64M
thread_stack            = 192K
max_connections         = &lt;%= exists $conf-&gt;{&quot;max_connections&quot;} ? $conf-&gt;{&quot;max_connections&quot;} : &quot;1000&quot; %&gt;

max_connect_errors      = 1000
table_cache             = &lt;%= exists $conf-&gt;{&quot;table_cache&quot;} ? $conf-&gt;{&quot;table_cache&quot;} : &quot;5000&quot; %&gt;
table_open_cache        = &lt;%= exists $conf-&gt;{&quot;table_open_cache&quot;} ? $conf-&gt;{&quot;table_open_cache&quot;} : &quot;5000&quot; %&gt;
thread_concurrency      = 10

#
# ... and more ...
#
</code></pre>

<p>Than you can reference on it from within your Rexfile.</p>

<pre><code>use Rex -feature =&gt; [&#39;1.0&#39;];

user &quot;root&quot;;
key_auth;

group databases=&gt; &quot;mydb01&quot;, &quot;mydb02&quot;;

task &quot;prepare_databases&quot;, group =&gt; &quot;databases&quot;, sub {
   file &quot;/etc/my.cnf&quot;,
      owner   =&gt; &quot;root&quot;,
      group   =&gt; &quot;root&quot;,
      mode    =&gt; &quot;644&quot;,
      content =&gt; template(&quot;files/my.cnf.tpl&quot;, conf =&gt; {
                             max_connections =&gt; &quot;500&quot;,
                             table_cache     =&gt; &quot;2500&quot;,
                          });
};
</code></pre>

<h2 id="inlinetemplates">Inline Templates</h2>

<p>When you want to deliver a rexfile that includes the templates, you can use inline templates. To use this feature, you have to use the __DATA__ section of your rexfile. You can also define several templates in that section:</p>

<h3 id="usingasingleinlinetemplate">Using a single inline template</h3>

<pre><code>use Rex -feature =&gt; [&#39;1.0&#39;];

task tempfiles =&gt; sub {
    file &#39;/tmp/test.txt&#39; =&gt;
        content =&gt; template(
            &#39;@test&#39;,
            test =&gt; {
                author =&gt; &#39;reneeb&#39;,
                target =&gt; &#39;rex&#39;,
            },
        ),
        chmod =&gt; 644,
    ;
};

__DATA__
@test
This is a test written by &lt;%= $test-&gt;{author} %&gt;
for a project called &lt;%= $test-&gt;{target} %&gt;
@end
</code></pre>

<p>The <code>__DATA__</code> section is the last section of the Rexfile. The first parameter of the template method call gets the name of the inline template. Note that names of inline templates begin with <code>@</code>.</p>

<p>Rex knows that it has to look up the template in the <code>__DATA__</code> section of the file where template was called. Within the section the template starts with its name (here: <code>@test</code>) and then follows the template text.</p>

<h3 id="usingmultipleinlinetemplates">Using multiple inline templates</h3>

<pre><code>use Rex -feature =&gt; [&#39;1.0&#39;];
task tempfiles =&gt; sub {
    file &#39;/tmp/test.txt&#39; =&gt;
        content =&gt; template(
            &#39;@test&#39;,
            test =&gt; {
                author =&gt; &#39;reneeb&#39;,
                target =&gt; &#39;rex&#39;,
            },
        ),
        chmod =&gt; 644,
    ;

    file &#39;/tmp/rex.txt&#39; =&gt;
        content =&gt; template(&gt;
            &#39;@rex&#39;,
            test =&gt; {
                author =&gt; &#39;krimdomu&#39;,
                target =&gt; &#39;rex&#39;,
            },
        ),
        chmod =&gt; 644,
    ;
};

__DATA__
@test
This is a test written by &lt;%= $test-&gt;{author} %&gt;
for a project called &lt;%= $test-&gt;{target} %&gt;
@end

@rex
Contribution by &lt;%= $test-&gt;{author} %&gt;
for a project called &lt;%= $test-&gt;{target} %&gt;
@end
</code></pre>

<p>Now we just look at the <code>__DATA__</code> section: You notice the token <code>@end</code>. This is used to separate the templates. At the end of each template (except for the last one) this token is needed. Otherwise Rex will use everything up to the first <code>@end</code> as the template which is most likely too much.</p>



            </div>
         </div> <!-- content -->

       <!-- page -->


     <a href="http://github.com/RexOps/Rex"><img alt="Fork me on GitHub" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" style="position: absolute; top: 0; right: 0; border: 0;"></a>

   <div class="clearfix"></div>
   <div class="bottom_bar">
      <a href="https://groups.google.com/group/rex-users/">Google Group</a> / <a href="http://twitter.com/RexOps">Twitter</a> / <a href="https://github.com/RexOps/Rex">GitHub</a> / <a href="http://www.freelists.org/list/rex-users">Mailinglist</a> / <a href="irc://irc.freenode.net/rex">irc.freenode.net #rex</a><span id="syntax_high" style="display: none;"> / <a href="#" id="link_syntax_high">Enable Syntax Highlighting</a></span>   -.ô.-   <a href="http://www.disclaimer.de/disclaimer.htm" target="_blank">Disclaimer</a>
   </div>

   <script charset="utf-8" src="/rexify-website/public/js/skin/rexify.org/jquery.js" type="text/javascript"></script>
   <script charset="utf-8" src="/rexify-website/public/js/skin/rexify.org/bootstrap.min.js" type="text/javascript"></script>
   <script charset="utf-8" src="/rexify-website/public/js/skin/rexify.org/menu.js" type="text/javascript"></script>
   <script charset="utf-8" src="/rexify-website/public/js/skin/rexify.org/ZeroClipboard.min.js" type="text/javascript"></script>

   <script>
      var client = new ZeroClipboard($(".copy-button"), { moviePath: "/public/js/skin/rexify.org/ZeroClipboard.swf"});
   </script>

   <script>
      if($(window).width() <= 1100) {
         // hide API link
         $("#li_api").hide();
      }
      $(window).on('resize', function() {
       if($(window).width() <= 1100) {
         // hide API link
         $("#li_api").hide();
       }
       else {
         $("#li_api").show();
       }

      });
   </script>


<script src="/rexify-website/public/js/skin/rexify.org/browser.js"></script>
<script>
  hljs.tabReplace = '    ';
//  hljs.initHighlighting();
  hljs.initHighlightingOnLoad();
</script>


   </body>

</html>
