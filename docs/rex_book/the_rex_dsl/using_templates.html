<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html prefix="og: http://ogp.me/ns#" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta content="text/html; charset=utf-8" http-equiv="content-type">

      <title>Using templates</title>

      <meta content="Using templates" property="og:title">
      <meta content="website" property="og:type">
      <meta content="https://www.rexify.org/docs/rex_book/the_rex_dsl/using_templates.html" property="og:url">
      <meta content="https://www.rexify.org/public/images/skin/rexify.org/open_graph.png" property="og:image">

      <meta content="width=1024, initial-scale=0.5" name="viewport">
      <link href="/public/images/skin/rexify.org/favicon.png" rel="shortcut icon">
      <link href="/public/css/skin/rexify.org/hs/tomorrow.css" rel="stylesheet">
      <link charset="utf-8" href="/public/css/skin/rexify.org/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css">
      <link charset="utf-8" href="/public/css/skin/rexify.org/default.css" media="screen" rel="stylesheet" type="text/css">
      <meta content="" name="description">
      <meta content="" name="keywords">

   </head>
   <body>

      <div id="page">

         <div class="top_div" id="top-div">
            <h1>(R)?ex <small>the friendly automation framework</small></h1>
            <div id="nav-div">
               
<div class="nav_links">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/get/index.html">Get Rex</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/care/index.html">Care</a>
      <ul class="dropdown_menu dropdown_care">
          <li><a href="/care/help__r__ex.html">Help (R)?ex</a></li>
          <li><a href="/care/help_people_in_need.html">Help people</a></li>
      </ul>
    </li>
    <li><a href="/support/index.html">Support</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/docs/index.html">Docs</a>
      <ul class="dropdown_menu dropdown_docs">
          <li><a href="/docs/faq/index.html">FAQ</a></li>
          <li><a href="/docs/guides/index.html">Guides</a></li>
          <li><a href="/docs/rex_book/index.html">Rex Book (work in progress)</a></li>
          <li><a href="/docs/release_notes/index.html">Release notes</a></li>
            <li class="divider"></li>
          <li><a href="https://metacpan.org/release/Rex">API</a></li>
      </ul>
    </li>
  </ul>
</div>

            </div>
            </div>
         </div>

         <div id="widgets_container">
            <div id="widgets">
               <h2>News</h2>
                   <p><b>2020-04-05</b><br>
                     <a href="/blog/2020/04/05/rex-1.9.0.html">Rex-1.9.0</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.9.0.html">Rex-1.9.0 release</a> is now available on <a href="https://metacpan.org/release/Rex">CPAN</a>, and it adds a new feature flag to force writing UTF-8 encoded files, <a href="https://metacpan.org/pod/Rex::Config">documents configuration options</a>, and fixes bugs.</p>

                   <p><b>2020-03-05</b><br>
                     <a href="/blog/2020/03/05/rex-1.8.2.html">Rex-1.8.2</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.8.2.html">Rex-1.8.2 release</a> is now available on <a href="https://metacpan.org/release/Rex">CPAN</a>, fixing a bug related to task hooks.</p>

                   <p><b>2020-02-05</b><br>
                     <a href="/blog/2020/02/05/rex-1.8.1.html">Rex-1.8.1</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.8.1.html">Rex-1.8.1 release</a> is now available on <a href="https://metacpan.org/release/Rex">CPAN</a>, improving release automation, packaging, and documentation.</p>

                   <p><b>2020-01-05</b><br>
                     <a href="/blog/2020/01/05/rex-1.8.0.html">Rex-1.8.0</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.8.0.html">Rex-1.8.0 release</a> is now available on <a href="https://metacpan.org/release/Rex">CPAN</a>, adding initial support to manage Void Linux systems.</p>

                   <p><b>2019-12-05</b><br>
                     <a href="/blog/2019/12/05/rex-1.7.1.html">Rex-1.7.1</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.7.1.html">Rex-1.7.1 release</a> is now available on <a href="https://metacpan.org/release/Rex">CPAN</a>, fixing a Windows testing issue, and updating some docs.</p>


               <h2>Conferences</h2>
                 <div class="news_widget">
                    <div class="news_date">2016-06-21</div>
                    <div class="news_content"><a href="http://preaction.me/">Doug Bell (preaction)</a> from <a href="http://chicago.pm.org/">Chicago.pm</a> will give an <a href="http://www.yapcna.org/yn2016/talk/6549">Introduction to Rex</a> talk at <a href="http://www.yapcna.org/yn2016/">YAPC::NA 2016</a>.</div>
                 </div>

               <h2>Need Help?</h2>
               <p>Rex is a pure open source project, you can find community support in the following places:</p>
               <ul>
                  <li>IRC: <a href="irc://irc.freenode.net/rex">#rex on irc.freenode.net</a></li>
                  <li>Groups: <a href="https://groups.google.com/group/rex-users/">Rex Users</a></li>
                  <li>Serverfault: <a href="http://serverfault.com/questions/tagged/rex">Tag with <i>rex</i></a></li>
                  <li>Issues: <a href="https://github.com/RexOps/Rex/issues">on GitHub</a></li>
                  <li>Feature: you miss a <a href="/care/help__r__ex.html">feature</a>?</li>
               </ul>
               <p><a href="/support/index.html">Professional support</a> is also available.</p>
            </div>
         </div> <!-- widgets -->

         <div id="content_container">
            <div id="content">
                




<p>
» <a href="/index.html">Home</a>
» <a href="/docs/index.html">Docs</a>
» <a href="/docs/rex_book/index.html">Rex book</a>
» <a href="/docs/rex_book/the_rex_dsl/index.html">The rex dsl</a>
» <a href="/docs/rex_book/the_rex_dsl/using_templates.html">Using templates</a>
</p>

              
              <h1>Using templates</h1>
              <p>A template is a text file containing special variables or perl code inside it. So with this technique you can generate dynamic configuration files. For example if you want to configure apache only to listen on a special ethernet device (eth0 for example) templates are what you need.</p>

<p>The default template engine is a special Rex template engine. The syntax is a bit like php or erb. But you can use any template engine you want. Just browse cpan and find one you like.</p>

<p>For example:</p>

<pre><code>Hello &lt;%= $name %&gt;!
</code></pre>

<p>If $name contains &quot;World&quot; this template would result in the string Hello World!. This is very useful if you have to maintain a large set of nearly identical configuration files.</p>

<h2 id="workingwithatemplate">Working with a template</h2>

<p>First you have to create it</p>

<pre><code>$ mkdir files
$ vim files/my.cnf.tpl

[mysqld]
datadir                 = /var/lib/mysql
socket                  = /var/run/mysqld/mysqld.sock
user                    = mysql
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links          = 0
datadir                 = /var/lib/mysql
tmpdir                  = /tmp
skip-external-locking
max_allowed_packet      = 64M
thread_stack            = 192K
max_connections         = &lt;%= exists $conf-&gt;{&quot;max_connections&quot;} ? $conf-&gt;{&quot;max_connections&quot;} : &quot;1000&quot; %&gt;

max_connect_errors      = 1000
table_cache             = &lt;%= exists $conf-&gt;{&quot;table_cache&quot;} ? $conf-&gt;{&quot;table_cache&quot;} : &quot;5000&quot; %&gt;
table_open_cache        = &lt;%= exists $conf-&gt;{&quot;table_open_cache&quot;} ? $conf-&gt;{&quot;table_open_cache&quot;} : &quot;5000&quot; %&gt;
thread_concurrency      = 10

#
# ... and more ...
#
</code></pre>

<p>Than you can reference on it from within your Rexfile.</p>

<pre><code class="hljs">⁠use Rex -feature =&gt; [&#39;<span class="hljs-string">1.0</span>&#39;];
⁠
⁠user &quot;<span class="hljs-string">root</span>&quot;;
⁠key_auth;
⁠
⁠group databases =&gt; &quot;<span class="hljs-string">mydb01</span>&quot;, &quot;<span class="hljs-string">mydb02</span>&quot;;
⁠
⁠task &quot;<span class="hljs-string">prepare_databases</span>&quot;,
⁠  group =&gt; &quot;<span class="hljs-string">databases</span>&quot;,
⁠  <span class="hljs-keyword">sub </span>{
⁠    file &quot;<span class="hljs-string">/etc/my.cnf</span>&quot;,
⁠      owner   =&gt; &quot;<span class="hljs-string">root</span>&quot;,
⁠      group   =&gt; &quot;<span class="hljs-string">root</span>&quot;,
⁠      mode    =&gt; &quot;<span class="hljs-string">644</span>&quot;,
⁠      content =&gt; template(
⁠        &quot;<span class="hljs-string">files/my.cnf.tpl</span>&quot;,
⁠        conf =&gt; {
⁠            max_connections =&gt; &quot;<span class="hljs-string">500</span>&quot;,
⁠            table_cache     =&gt; &quot;<span class="hljs-string">2500</span>&quot;,
⁠        }
⁠      );
⁠  };</code></pre>

<h2 id="inlinetemplates">Inline Templates</h2>

<p>When you want to deliver a rexfile that includes the templates, you can use inline templates. To use this feature, you have to use the __DATA__ section of your rexfile. You can also define several templates in that section:</p>

<h3 id="usingasingleinlinetemplate">Using a single inline template</h3>

<pre><code class="hljs">⁠<span class="hljs-keyword">use</span> Rex -feature =&gt; [&#39;<span class="hljs-string">1.0</span>&#39;];
⁠
⁠task tempfiles =&gt; <span class="hljs-keyword">sub </span>{
⁠    file &#39;<span class="hljs-string">/tmp/test.txt</span>&#39; =&gt; content =&gt; template(
⁠        &#39;<span class="hljs-string">@test</span>&#39;,
⁠        test =&gt; {
⁠            author =&gt; &#39;<span class="hljs-string">reneeb</span>&#39;,
⁠            target =&gt; &#39;<span class="hljs-string">rex</span>&#39;,
⁠        },
⁠      ),
⁠      <span class="hljs-function">chmod</span> =&gt; <span class="hljs-number">644</span>,
⁠      ;
⁠};
⁠
⁠<span class="hljs-keyword">__DATA__</span>
⁠@test
⁠This is a test written by &lt;%= $test-&gt;{author} %&gt;
⁠for a project called &lt;%= $test-&gt;{target} %&gt;
⁠@end</code></pre>

<p>The <code>__DATA__</code> section is the last section of the Rexfile. The first parameter of the template method call gets the name of the inline template. Note that names of inline templates begin with <code>@</code>.</p>

<p>Rex knows that it has to look up the template in the <code>__DATA__</code> section of the file where template was called. Within the section the template starts with its name (here: <code>@test</code>) and then follows the template text.</p>

<h3 id="usingmultipleinlinetemplates">Using multiple inline templates</h3>

<pre><code class="hljs">⁠use Rex -feature =&gt; [&#39;<span class="hljs-string">1.0</span>&#39;];
⁠task tempfiles   =&gt; <span class="hljs-keyword">sub </span>{
⁠    file &#39;<span class="hljs-string">/tmp/test.txt</span>&#39; =&gt; content =&gt; template(
⁠        &#39;<span class="hljs-string">@test</span>&#39;,
⁠        test =&gt; {
⁠            author =&gt; &#39;<span class="hljs-string">reneeb</span>&#39;,
⁠            target =&gt; &#39;<span class="hljs-string">rex</span>&#39;,
⁠        },
⁠      ),
⁠      <span class="hljs-function">chmod</span> =&gt; <span class="hljs-number">644</span>,
⁠      ;
⁠
⁠    file &#39;<span class="hljs-string">/tmp/rex.txt</span>&#39; =&gt; content =&gt; template(
⁠        &#39;<span class="hljs-string">@rex</span>&#39;,
⁠        test =&gt; {
⁠            author =&gt; &#39;<span class="hljs-string">krimdomu</span>&#39;,
⁠            target =&gt; &#39;<span class="hljs-string">rex</span>&#39;,
⁠        },
⁠      ),
⁠      <span class="hljs-function">chmod</span> =&gt; <span class="hljs-number">644</span>,
⁠      ;
⁠};
⁠
⁠<span class="hljs-keyword">__DATA__</span>
⁠@test
⁠This is a test written by &lt;%= $test-&gt;{author} %&gt;
⁠for a project called &lt;%= $test-&gt;{target} %&gt;
⁠@end
⁠
⁠@rex
⁠Contribution by &lt;%= $test-&gt;{author} %&gt;
⁠for a project called &lt;%= $test-&gt;{target} %&gt;
⁠@end</code></pre>

<p>Now we just look at the <code>__DATA__</code> section: You notice the token <code>@end</code>. This is used to separate the templates. At the end of each template (except for the last one) this token is needed. Otherwise Rex will use everything up to the first <code>@end</code> as the template which is most likely too much.</p>



            </div>
         </div> <!-- content -->

       <!-- page -->


   <div class="clearfix"></div>
   <div class="bottom_bar">
      <p>Proudly powered by <a href="http://preaction.me/statocles/">Statocles</a></p>
      <a href="https://groups.google.com/group/rex-users/">Google Group</a> / <a href="http://twitter.com/RexOps">Twitter</a> / <a href="https://github.com/RexOps/Rex">GitHub</a> / <a href="http://www.freelists.org/list/rex-users">Mailinglist</a> / <a href="irc://irc.freenode.net/rex">irc.freenode.net #rex</a>   -.ô.-   <a href="http://www.disclaimer.de/disclaimer.htm" target="_blank">Disclaimer</a>
   </div>

   </body>

</html>
