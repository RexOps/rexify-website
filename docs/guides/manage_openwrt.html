<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html prefix="og: http://ogp.me/ns#" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta content="text/html; charset=utf-8" http-equiv="content-type">

      <title>Manage OpenWrt</title>

      <meta content="Manage OpenWrt" property="og:title">
      <meta content="website" property="og:type">
      <meta content="https://www.rexify.org/docs/guides/manage_openwrt.html" property="og:url">
      <meta content="https://www.rexify.org/public/images/skin/rexify.org/open_graph.png" property="og:image">

      <meta content="width=1024, initial-scale=0.5" name="viewport">
      <link href="/public/images/skin/rexify.org/favicon.png" rel="shortcut icon">
      <link href="/public/css/skin/rexify.org/hs/tomorrow.css" rel="stylesheet">
      <link charset="utf-8" href="/public/css/skin/rexify.org/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css">
      <link charset="utf-8" href="/public/css/skin/rexify.org/default.css" media="screen" rel="stylesheet" type="text/css">
      <meta content="" name="description">
      <meta content="" name="keywords">

   </head>
   <body>

      <div id="page">

         <div class="top_div" id="top-div">
            <h1>(R)?ex <small>the friendly automation framework</small></h1>
            <div id="nav-div">
               
<div class="nav_links">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/get/index.html">Get Rex</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/care/index.html">Care</a>
      <ul class="dropdown_menu dropdown_care">
          <li><a href="/care/help__r__ex.html">Help (R)?ex</a></li>
          <li><a href="/care/help_people_in_need.html">Help people</a></li>
      </ul>
    </li>
    <li><a href="/support/index.html">Support</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/docs/index.html">Docs</a>
      <ul class="dropdown_menu dropdown_docs">
          <li><a href="/docs/faq/index.html">FAQ</a></li>
          <li><a href="/docs/guides/index.html">Guides</a></li>
          <li><a href="/docs/rex_book/index.html">Rex Book (work in progress)</a></li>
          <li><a href="/docs/release_notes/index.html">Release notes</a></li>
            <li class="divider"></li>
          <li><a href="https://metacpan.org/release/Rex">API</a></li>
      </ul>
    </li>
  </ul>
</div>

            </div>
            </div>
         </div>

         <div id="widgets_container">
            <div id="widgets">
               <h2>News</h2>
                   <p><b>2020-11-05</b><br>
                     <a href="/blog/2020/11/05/rex-1.13.1.html">Rex-1.13.1</a></p><p>
                   </p><p></p><p><a href="https://github.com/RexOps/Rex/commit/cabbc6a8aa9eb2c0d9d3fc2439be51924edc3ff8">Happy 10th birthday, Rex!</a></p>

<p>The <a href="/docs/release_notes/1.13.1.html">Rex-1.13.1 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.13.1">available on CPAN</a>. It is focusing on CMDB bugfixes and documentation, while also fixing a missing feature flag. Upgrade is recommended for all users.</p>

                   <p><b>2020-10-05</b><br>
                     <a href="/blog/2020/10/05/rex-1.13.0.html">Rex-1.13.0</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.13.0.html">Rex-1.13.0 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.13.0">available on CPAN</a>. It adds <code>on_no_change</code> hooks for file management commands to trigger further actions when files are left unchanged. Upgrade is recommended for all users.</p>

                   <p><b>2020-09-05</b><br>
                     <a href="/blog/2020/09/05/rex-1.12.2.html">Rex-1.12.2</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.12.2.html">Rex-1.12.2 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.12.2">available on CPAN</a>. It fixes various regressions, as well as bugs around file management. Upgrade is highly recommended for all users.</p>

                   <p><b>2020-08-05</b><br>
                     <a href="/blog/2020/08/05/rex-1.12.1.html">Rex-1.12.1</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.12.1.html">Rex-1.12.1 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.12.1">available on CPAN</a>. It adds documentation for feature flags, and fixes a release packaging issue.</p>

                   <p><b>2020-07-05</b><br>
                     <a href="/blog/2020/07/05/rex-1.12.0.html">Rex-1.12.0</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.12.0.html">Rex-1.12.0 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.12.0">available on CPAN</a>. It adds support for local rsync operations, improves tab completion for Bash and Zsh, and fixes related bugs. It also discontinues support for running Rex on Windows 7, Windows Server 2008 R2, and older versions since both mainstream and extended support has already ended for these products.</p>


               <h2>Conferences</h2>
                 <div class="news_widget">
                    <div class="news_date">2016-06-21</div>
                    <div class="news_content"><a href="http://preaction.me/">Doug Bell (preaction)</a> from <a href="http://chicago.pm.org/">Chicago.pm</a> will give an <a href="http://www.yapcna.org/yn2016/talk/6549">Introduction to Rex</a> talk at <a href="http://www.yapcna.org/yn2016/">YAPC::NA 2016</a>.</div>
                 </div>

               <h2>Need Help?</h2>
               <p>Rex is a pure open source project, you can find community support in the following places:</p>
               <ul>
                  <li>IRC: <a href="irc://irc.freenode.net/rex">#rex on irc.freenode.net</a></li>
                  <li>Groups: <a href="https://groups.google.com/group/rex-users/">Rex Users</a></li>
                  <li>Serverfault: <a href="http://serverfault.com/questions/tagged/rex">Tag with <i>rex</i></a></li>
                  <li>Issues: <a href="https://github.com/RexOps/Rex/issues">on GitHub</a></li>
                  <li>Feature: you miss a <a href="/care/help__r__ex.html">feature</a>?</li>
               </ul>
               <p><a href="/support/index.html">Professional support</a> is also available.</p>
            </div>
         </div> <!-- widgets -->

         <div id="content_container">
            <div id="content">
                




<p>
» <a href="/index.html">Home</a>
» <a href="/docs/index.html">Docs</a>
» <a href="/docs/guides/index.html">Guides</a>
» <a href="/docs/guides/manage_openwrt.html">Manage OpenWrt</a>
</p>

              
              <h1>Manage OpenWrt</h1>
              <p><a href="https://openwrt.org/">OpenWrt</a> is a Linux distribution for embedded devices and it is primarily aimed for and used on routers. This means that every component is optimized for size to fit into the limited resource constraints of these devices. As a result some things are working a bit differently than on a full-blown desktop or server distribution. This guide tries to help you getting started with using Rex to manage OpenWrt boxes.</p>

<h2 id="overview">Overview</h2>

<h3 id="whatsworking">What&#39;s working?</h3>

<p>Please see the official compatibility page. You may also want to check the current project weather on build.rexify.org.</p>

<h3 id="knownlimitations">Known limitations</h3>

<ul>
<li>Service status
Despite OpenWrt provides a service_check() function in /lib/functions/service.sh, it seems that it&#39;s only sporadically used in initscripts. Nevertheless Rex currently implements its service status check via this function but it&#39;s more of a workaround than a solution. It&#39;s also worth noting that sometimes the initscript&#39;s name and its executable&#39;s name are not the same (e.g cron vs. crond). You should use the executable&#39;s name in your OpenWrt status checks.</li>
<li>Missing renice
AFAIK renice isn&#39;t available for OpenWrt.</li>
<li>Inventory gathering
OpenWrt doesn&#39;t provide dmidecode for all architectures so this might or might not work for you.</li>
</ul>

<h3 id="requirements">Requirements</h3>

<ul>
<li>&gt;=rex-0.43: initial support has been added in this release</li>
<li>enabled no_tty feature flag when using OpenSSH connection mode</li>
<li>Attitude Adjustment (12.09 final) or Barrier Breaker (14.07 final)</li>
</ul>

<p>Generally you&#39;ll need the following packages on your OpenWrt box on top of a vanilla install:</p>

<ul>
<li>SFTP server: openssh-sftp-server or gesftpserver (only available for 12.09)</li>
<li>perl</li>
<li>perl modules: perlbase-bytes perlbase-data perlbase-digest perlbase-essential perlbase-file perlbase-xsloader</li>
<li>if you use &gt;=rex-0.46: coreutils-nohup (required for service handling)</li>
</ul>

<p>Optional packages (only for specific Rex functions):</p>

<ul>
<li>sync_up: rsync</li>
<li>user management: shadow-groupadd shadow-groupdel shadow-groupmod shadow-useradd shadow-userdel shadow-usermod</li>
<li>inventory gathering: dmidecode</li>
<li>swap handling: swap-utils (+ block-mount on 14.07)</li>
</ul>

<h4 id="details">Details</h4>

<h5 id="sftpserver">SFTP server</h5>

<p>By default OpenWrt doesn&#39;t provide an SFTP server. As Rex does lots of lower level operations via SFTP (<code>is_dir()</code>, <code>is_file()</code>, ...), the first package you should install on your box is either openssh-sftp-server or gesftpserver.</p>

<p>A massively subjective comparison of these two may help to make your decision:</p>

<h5 id="openssh-sftp-server">openssh-sftp-server</h5>

<ul>
<li>easier to set up</li>
<li>a bit smaller size in itself</li>
<li>depends on libopenssl and zlib (and they are &quot;huge&quot; and probably not needed by other packages)</li>
<li>only supports SFTP v3 (that should be fine in general though)</li>
<li>widespread use</li>
<li>BSD licensed</li>
</ul>

<p>It can be set up with the following commands:</p>

<pre><code>opkg update
opkg install openssh-sftp-server
</code></pre>

<h5 id="gesftpserver">gesftpserver</h5>

<ul>
<li>only available for 12.09</li>
<li>needs some (minimal) tinkering after installation</li>
<li>a bit bigger in size in itself</li>
<li>no cumbersome dependencies, good for minimal systems</li>
<li>supports SFTP v3-v6</li>
<li>still under development</li>
<li>GPL licensed</li>
</ul>

<p>It can be set up with the following commands:</p>

<pre><code>opkg update
opkg install gesftpserver
mkdir /usr/libexec
ln -s /usr/bin/gesftpserver /usr/libexec/sftp-server
</code></pre>

<p>If you want to automate the set up of the chosen SFTP server on a fresh OpenWrt installation, just put the according steps into <code>run</code> calls in a Rex task. The bottom line is to don&#39;t try to use the built-in <code>mkdir</code> and <code>symlink</code> functions at this point as they are broken before you have an SFTP server in place.
You can find out more about gesftpserver and a comparison of different SFTP implementations/versions on their <a href="http://www.greenend.org.uk/rjk/sftpserver/">website</a>.</p>

<h5 id="perl">Perl</h5>

<p>You&#39;ll need to install the following packages:</p>

<ul>
<li>perl: obviously</li>
<li>perlbase-bytes, perlbase-essential: very basic set of perl modules</li>
<li>perlbase-data: for Data::Dumper</li>
<li>perlbase-file: for glob operations</li>
<li>perlbase-digest: perlbase-data dependency and it is nice to have in order to speed up file operations in general (via MD5 hashing)</li>
<li>perlbase-xsloader: perlbase-data and perlbase-file dependency</li>
</ul>

<h5 id="rsync">rsync</h5>

<p>Merely needed by sync_up functionality.</p>

<h5 id="shadow-">shadow-*</h5>

<p>OpenWrt doesn&#39;t provide traditional user and group management commands by default as these procedures are rarely needed in the majority of the targeted use cases. However, if you really need to do these type of stuff on your router, you&#39;re in luck, as you can easily install these packages from the official repository:</p>

<ul>
<li>shadow-groupadd</li>
<li>shadow-groupdel</li>
<li>shadow-groupmod</li>
<li>shadow-useradd</li>
<li>shadow-userdel</li>
<li>shadow-usermod</li>
</ul>



            </div>
         </div> <!-- content -->

       <!-- page -->


   <div class="clearfix"></div>
   <div class="bottom_bar">
      <p>Proudly powered by <a href="http://preaction.me/statocles/">Statocles</a></p>
      <a href="https://groups.google.com/group/rex-users/">Google Group</a> / <a href="http://twitter.com/RexOps">Twitter</a> / <a href="https://github.com/RexOps/Rex">GitHub</a> / <a href="http://www.freelists.org/list/rex-users">Mailinglist</a> / <a href="irc://irc.freenode.net/rex">irc.freenode.net #rex</a>   -.ô.-   <a href="http://www.disclaimer.de/disclaimer.htm" target="_blank">Disclaimer</a>
   </div>

   </body>

</html>
