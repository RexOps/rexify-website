<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html prefix="og: http://ogp.me/ns#" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta content="text/html; charset=utf-8" http-equiv="content-type">

      <title>How to start using (R)?ex</title>

      <meta content="How to start using (R)?ex" property="og:title">
      <meta content="website" property="og:type">
      <meta content="https://www.rexify.org/docs/guides/start_using__r__ex.html" property="og:url">
      <meta content="https://www.rexify.org/public/images/skin/rexify.org/open_graph.png" property="og:image">

      <meta content="width=1024, initial-scale=0.5" name="viewport">
      <link href="/public/images/skin/rexify.org/favicon.png" rel="shortcut icon">
      <link href="/public/css/skin/rexify.org/hs/tomorrow.css" rel="stylesheet">
      <link charset="utf-8" href="/public/css/skin/rexify.org/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css">
      <link charset="utf-8" href="/public/css/skin/rexify.org/default.css" media="screen" rel="stylesheet" type="text/css">
      <meta content="" name="description">
      <meta content="" name="keywords">

   </head>
   <body>

      <div id="page">

         <div class="top_div" id="top-div">
            <h1>(R)?ex <small>the friendly automation framework</small></h1>
            <div id="nav-div">
               
<div class="nav_links">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/get/index.html">Get Rex</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/care/index.html">Care</a>
      <ul class="dropdown_menu dropdown_care">
          <li><a href="/care/help__r__ex.html">Help (R)?ex</a></li>
          <li><a href="/care/help_people_in_need.html">Help people</a></li>
      </ul>
    </li>
    <li><a href="/support/index.html">Support</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/docs/index.html">Docs</a>
      <ul class="dropdown_menu dropdown_docs">
          <li><a href="/docs/faq/index.html">FAQ</a></li>
          <li><a href="/docs/guides/index.html">Guides</a></li>
          <li><a href="/docs/rex_book/index.html">Rex Book (work in progress)</a></li>
          <li><a href="/docs/release_notes/index.html">Release notes</a></li>
            <li class="divider"></li>
          <li><a href="https://metacpan.org/release/Rex">API</a></li>
      </ul>
    </li>
  </ul>
</div>

            </div>
            </div>
         </div>

         <div id="widgets_container">
            <div id="widgets">
               <h2>News</h2>
                   <p><b>2020-08-05</b><br>
                     <a href="/blog/2020/08/05/rex-1.12.1.html">Rex-1.12.1</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.12.1.html">Rex-1.12.1 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.12.1">available on CPAN</a>. It adds documentation for feature flags, and fixes a release packaging issue.</p>

                   <p><b>2020-07-05</b><br>
                     <a href="/blog/2020/07/05/rex-1.12.0.html">Rex-1.12.0</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.12.0.html">Rex-1.12.0 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.12.0">available on CPAN</a>. It adds support for local rsync operations, improves tab completion for Bash and Zsh, and fixes related bugs. It also discontinues support for running Rex on Windows 7, Windows Server 2008 R2, and older versions since both mainstream and extended support has already ended for these products.</p>

                   <p><b>2020-06-09</b><br>
                     <a href="/blog/2020/06/09/rex-on-stackshare.html">Rex on StackShare</a></p><p>
                   </p><p></p><p>Thanks to the support from their amazing team, <a href="https://stackshare.io/rex">Rex is now listed on StackShare</a>.</p>

                   <p><b>2020-06-05</b><br>
                     <a href="/blog/2020/06/05/rex-1.11.0.html">Rex-1.11.0</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.11.0.html">Rex-1.11.0 release</a> is now <a href="https://metacpan.org/release/FERKI/Rex-1.11.0">available on CPAN</a>. It enhances the behaviour of sysctl and file management, fixes bugs about group management and OpenSSH connection options, and clarifies quite a bit of documentation.</p>

                   <p><b>2020-05-05</b><br>
                     <a href="/blog/2020/05/05/rex-1.10.0.html">Rex-1.10.0</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.10.0.html">Rex-1.10.0 release</a> is now available on <a href="https://metacpan.org/release/Rex">CPAN</a> (<a href="https://metacpan.org/source/FERKI/Rex-1.10.0/ChangeLog">changelog</a>). Apart from documentation updates and bug fixes, it adds initial package glob support, and an <code>on_change</code> hook for the <code>mkdir</code> command.</p>


               <h2>Conferences</h2>
                 <div class="news_widget">
                    <div class="news_date">2016-06-21</div>
                    <div class="news_content"><a href="http://preaction.me/">Doug Bell (preaction)</a> from <a href="http://chicago.pm.org/">Chicago.pm</a> will give an <a href="http://www.yapcna.org/yn2016/talk/6549">Introduction to Rex</a> talk at <a href="http://www.yapcna.org/yn2016/">YAPC::NA 2016</a>.</div>
                 </div>

               <h2>Need Help?</h2>
               <p>Rex is a pure open source project, you can find community support in the following places:</p>
               <ul>
                  <li>IRC: <a href="irc://irc.freenode.net/rex">#rex on irc.freenode.net</a></li>
                  <li>Groups: <a href="https://groups.google.com/group/rex-users/">Rex Users</a></li>
                  <li>Serverfault: <a href="http://serverfault.com/questions/tagged/rex">Tag with <i>rex</i></a></li>
                  <li>Issues: <a href="https://github.com/RexOps/Rex/issues">on GitHub</a></li>
                  <li>Feature: you miss a <a href="/care/help__r__ex.html">feature</a>?</li>
               </ul>
               <p><a href="/support/index.html">Professional support</a> is also available.</p>
            </div>
         </div> <!-- widgets -->

         <div id="content_container">
            <div id="content">
                




<p>
» <a href="/index.html">Home</a>
» <a href="/docs/index.html">Docs</a>
» <a href="/docs/guides/index.html">Guides</a>
» <a href="/docs/guides/start_using__r__ex.html">How to start using (R)?ex</a>
</p>

              
              <h1>How to start using (R)?ex</h1>
              <p>This is a small how to showing the first steps with Rex.</p>

<h2 id="basicarchitecture">Basic architecture</h2>

<p><img alt="Basic architecture" height="272" src="/public/images/skin/rexify.org/archi.png" style="float: right;" width="410"></p>

<p>Rex is an automation framework which can manage local machines and uses SSH as an agent to manage remote ones.</p>

<p>Rex provides a simple DSL that is completely syntax-compatible with Perl. You can use it without any Perl experience if you want, but you can easily learn <a href="/docs/guides/just_enough_perl_for_rex.html">just enough Perl for Rex</a>.</p>

<p>The starting point of every Rex project is the so-called Rexfile. You can think of this file like a Makefile. You can define your inventory, environments, authentication info and tasks in this file, among many other things.</p>

<p>A task is really just a bunch of related commands. For example installing a package, uploading the configuration file and starting the service. You can also call tasks from other tasks or create rollback scenarios to handle cases when something goes wrong during the execution.</p>

<h2 id="requirements">Requirements</h2>

<p>To run Rex you don&#39;t need much.</p>

<h3 id="controlhost">Control host</h3>

<p>You can run Rex from your workstation or on a central control host.</p>

<p>Rex requires at least Perl 5.10.1 on this machine, and of course some modules as dependencies. For the best experience we recommend using the <a href="https://www.perl.org/get.html">latest stable release of Perl</a>. If you&#39;re using the packages provided by your OS distribution, or you install Rex from CPAN, then those dependencies will be installed automatically.</p>

<p>You can find information on the <a href="/get/index.html">Get Rex</a> page about how to install Rex itself.</p>

<h3 id="managedhosts">Managed hosts</h3>

<p>On the systems you want to manage you need only two things: a Perl 5 interpreter, and a valid account for the SSH server running there.</p>

<p>Rex only uses core Perl modules on the remote hosts, but some operating systems (e.g. RHEL/CentOS, Fedora, OpenWRT) might not supply all of them out of the box. In this case you might need to install them first, and this mostly means the Digest::MD5 module (but it depends on the OS, really). You can install this module with <code>yum install perl-Digest-MD5</code>.</p>

<p>If you want to run administrative tasks on the remote machines, you obviously would need root access on them, or at least sudo to escalate privileges.</p>

<h2 id="creatingarexfile">Creating a Rexfile</h2>

<p>First we need to create a new directory to store your Rexfile in it, and change to that directory:</p>

<pre><code>$ mkdir my-first-rex-project
$ cd my-first-rex-project
</code></pre>

<p>Now change into this directory and create a file called Rexfile with the following contents:</p>

<pre><code class="hljs">⁠<span class="hljs-keyword">use</span> Rex -feature =&gt; [&#39;<span class="hljs-string">1.4</span>&#39;];
⁠
⁠user &#39;<span class="hljs-string">my-user</span>&#39;;
⁠password &#39;<span class="hljs-string">my-password</span>&#39;;
⁠
⁠group myservers =&gt; &#39;<span class="hljs-string">mywebserver</span>&#39;, &#39;<span class="hljs-string">mymailserver</span>&#39;, &#39;<span class="hljs-string">myfileserver</span>&#39;;
⁠
⁠desc &#39;<span class="hljs-string">Get the uptime of all servers</span>&#39;;
⁠task &#39;<span class="hljs-string">uptime</span>&#39;,
⁠  group =&gt; &#39;<span class="hljs-string">myservers</span>&#39;,
⁠  <span class="hljs-keyword">sub </span>{
⁠    <span class="hljs-keyword">my</span> <span class="hljs-type">$output</span> = run &#39;<span class="hljs-string">uptime</span>&#39;;
⁠    say <span class="hljs-type">$output</span>;
⁠  };</code></pre>

<p>The special first line <code>use Rex -feature =&gt; [&#39;1.4&#39;];</code> enables all features that are available for version 1.4. If you want to know more about feature flags, please check out the <a href="/docs/guides/feature_flags.html">How to enable or disable features</a> page.</p>

<p>Executing the <code>uptime</code> task will login as <code>my-user</code> with the password <code>my-password</code> to all the servers in the group <code>myservers</code> and run the command <code>uptime</code>. You can run it like this:</p>

<pre><code>$ rex uptime
</code></pre>

<h3 id="addingasecondtask">Adding a second task</h3>

<p>To add a second task, just add the next lines to your Rexfile.</p>

<pre><code class="hljs">⁠desc &#39;<span class="hljs-string">Start Apache service</span>&#39;;
⁠task &#39;<span class="hljs-string">start_apache</span>&#39;,
⁠  group =&gt; &#39;<span class="hljs-string">myservers</span>&#39;,
⁠  <span class="hljs-keyword">sub </span>{
⁠    service &#39;<span class="hljs-string">apache2</span>&#39; =&gt; &#39;<span class="hljs-string">start</span>&#39;;
⁠  };</code></pre>

<p>This task will start the service named <code>apache2</code> on all the servers in the <code>myservers</code> group.</p>

<h3 id="displayalltasksinarexfile">Display all tasks in a Rexfile</h3>

<p>Use the following command to display all tasks in your Rexfile use the following command:</p>

<pre><code>$ rex -T
Tasks
  start_apache                   Start Apache service
  uptime                         Get the uptime of all servers
Server Groups
  myservers                       mywebserver, mymailserver, myfileserver
</code></pre>

<h3 id="authentication">Authentication</h3>

<p>In the previous example we showed how you can login with a user and a password. Of course, it&#39;s easy to use key authentication instead, just add <code>key_auth</code> instead of <code>password</code>:</p>

<pre><code class="hljs">⁠user &#39;<span class="hljs-string">my-user</span>&#39;;
⁠key_auth;</code></pre>

<p>It is also possible to use your keys with a passphrase if you specify both <code>key_auth</code> and <code>password</code>:</p>

<pre><code class="hljs">⁠user &#39;<span class="hljs-string">my-user</span>&#39;;
⁠key_auth;
⁠password &#39;<span class="hljs-string">key-passphrase</span>&#39;;</code></pre>

<p>On Windows, you also have to point to your private and public keys:</p>

<pre><code class="hljs">⁠user &#39;<span class="hljs-string">my-user</span>&#39;;
⁠private_key &#39;<span class="hljs-string">/home/user/.ssh/id_rsa</span>&#39;;
⁠public_key &#39;<span class="hljs-string">/home/user/.ssh/id_rsa.pub</span>&#39;;
⁠key_auth;</code></pre>

<p>If you don&#39;t want to add your password or passphrase to the Rexfile, you can also get it from an external source, or you can use ssh-agent. Rex will automatically try to use it when you remove both <code>password</code> and <code>key_auth</code>.</p>

<p>And if you omit even <code>user</code>, it will just try to use the name of the currently logged in user.</p>

<p>For even more options, check out this <a href="/docs/rex_book/the_rex_dsl/authentication.html">Authentication</a> page.</p>

<h3 id="managingservices">Managing services</h3>

<p>Managing services really only need a few common steps: install, configure, and run (of course, add in destroy to get full life cycle management).</p>

<p>In this example you will learn how to install and configure an NTP server. You can adapt this example to any other service easily.</p>

<pre><code class="hljs">⁠<span class="hljs-comment"># Rexfile</span><span class="hljs-comment">
⁠</span><span class="hljs-keyword">use</span> Rex -feature =&gt; [&#39;<span class="hljs-string">1.4</span>&#39;];
⁠
⁠user &#39;<span class="hljs-string">root</span>&#39;;
⁠
⁠group all_servers =&gt; &#39;<span class="hljs-string">srv[001..003]</span>&#39;;
⁠
⁠task &#39;<span class="hljs-string">setup_ntp</span>&#39;,
⁠  group =&gt; &#39;<span class="hljs-string">all_servers</span>&#39;,
⁠  <span class="hljs-keyword">sub </span>{
⁠    pkg &#39;<span class="hljs-string">ntpd</span>&#39;, ensure =&gt; &#39;<span class="hljs-string">present</span>&#39;; <span class="hljs-comment"># let&#39;s install the package first</span><span class="hljs-comment">
⁠</span>
⁠    file &#39;<span class="hljs-string">/etc/ntp.conf</span>&#39;,                <span class="hljs-comment"># then upload a configuration file</span><span class="hljs-comment">
⁠</span>      source    =&gt; &#39;<span class="hljs-string">files/etc/ntp.conf</span>&#39;, <span class="hljs-comment"># use a source file under files/etc</span><span class="hljs-comment">
⁠</span>      on_change =&gt; <span class="hljs-keyword">sub </span>{                 <span class="hljs-comment"># and execute something if the file has changed</span><span class="hljs-comment">
⁠</span>        service ntpd =&gt; &#39;<span class="hljs-string">restart</span>&#39;;       <span class="hljs-comment"># in this case, restart the service</span><span class="hljs-comment">
⁠</span>      };
⁠
⁠    service &#39;<span class="hljs-string">ntpd</span>&#39;, ensure =&gt; &#39;<span class="hljs-string">started</span>&#39;; <span class="hljs-comment"># start the service now and also after reboot</span><span class="hljs-comment">
⁠</span>  };</code></pre>

<p>That&#39;s all.</p>

<p>This task will now install the <code>ntpd</code> package on your servers, upload a configuration file and start the service.</p>

<p>In case you wonder about the order of commands, Rex will always execute them from top to bottom.</p>

<p>If you want to learn more, it&#39;s probably best to continue reading about <a href="/docs/guides/using_modules_and_templates.html">using modules and templates</a>.</p>



            </div>
         </div> <!-- content -->

       <!-- page -->


   <div class="clearfix"></div>
   <div class="bottom_bar">
      <p>Proudly powered by <a href="http://preaction.me/statocles/">Statocles</a></p>
      <a href="https://groups.google.com/group/rex-users/">Google Group</a> / <a href="http://twitter.com/RexOps">Twitter</a> / <a href="https://github.com/RexOps/Rex">GitHub</a> / <a href="http://www.freelists.org/list/rex-users">Mailinglist</a> / <a href="irc://irc.freenode.net/rex">irc.freenode.net #rex</a>   -.ô.-   <a href="http://www.disclaimer.de/disclaimer.htm" target="_blank">Disclaimer</a>
   </div>

   </body>

</html>
