<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html prefix="og: http://ogp.me/ns#" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta content="text/html; charset=utf-8" http-equiv="content-type">

      <title>Howto start using (R)?ex</title>

      <meta content="Howto start using (R)?ex" property="og:title">
      <meta content="website" property="og:type">
      <meta content="https://www.rexify.org/docs/guides/start_using__r__ex.html" property="og:url">
      <meta content="https://www.rexify.org/public/images/skin/rexify.org/open_graph.png" property="og:image">

      <meta content="width=1024, initial-scale=0.5" name="viewport">
      <link href="/public/images/skin/rexify.org/favicon.png" rel="shortcut icon">
      <link href="/public/css/skin/rexify.org/hs/tomorrow.css" rel="stylesheet">
      <link charset="utf-8" href="/public/css/skin/rexify.org/bootstrap.min.css?20130325" media="screen" rel="stylesheet" type="text/css">
      <link charset="utf-8" href="/public/css/skin/rexify.org/default.css?20140412" media="screen" rel="stylesheet" type="text/css">
      <meta content="" name="description">
      <meta content="" name="keywords">

   </head>
   <body>

      <div id="page">

         <div class="top_div" id="top-div">
            <h1>(R)?ex <small>Deployment &amp; Configuration Management</small></h1>
            <div id="nav-div">
               
<div class="nav_links">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/get/index.html">Get Rex</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/care/index.html">Care</a>
      <ul class="dropdown_menu dropdown_care">
          <li><a href="/care/help__r__ex.html">Help (R)?ex</a></li>
          <li><a href="/care/help_people_in_need.html">Help people</a></li>
      </ul>
    </li>
    <li><a href="/support/index.html">Support</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/docs/index.html">Docs</a>
      <ul class="dropdown_menu dropdown_docs">
          <li><a href="/docs/faq/index.html">FAQ</a></li>
          <li><a href="/docs/guides/index.html">Guides</a></li>
          <li><a href="/docs/rex_book/index.html">Rex Book (work in progress)</a></li>
          <li><a href="/docs/release_notes/index.html">Release notes</a></li>
            <li class="divider"></li>
          <li><a href="https://metacpan.org/release/Rex">API</a></li>
      </ul>
    </li>
  </ul>
</div>

            </div>
            </div>
         </div>

         <div id="widgets_container">
            <div id="widgets">
               <h2>News</h2>
                   <p><b>2019-11-05</b><br>
                     <a href="/blog/2019/11/05/rex-1.7.0.html">Rex-1.7.0</a></p><p>
                   </p><p></p><p>The <a href="/docs/release_notes/1.7.0.html">Rex-1.7.0 release</a> is now available on <a href="https://metacpan.org/release/Rex">CPAN</a>.</p>

                   <p><b>2019-07-02</b><br>
                     <a href="/blog/2019/07/02/deprecating_official_rex_packages.html">Deprecating official Rex packages</a></p><p>
                   </p><p></p><p>As part of our efforts to simplify maintenance around RexOps projects, we have decided to stop building Rex packages on our side. We recommend relying on OS packages maintained by the various distributions in their respective upstream repositories, or to install Rex from CPAN.</p>

                   <p><b>2019-06-09</b><br>
                     <a href="/blog/2019/06/09/site-update.html">Post-migration updates &amp; clean-up</a></p><p>
                   </p><p></p><p>Over the course of the past weeks many clean-ups have been
done, reaping the benefits provided by our new
<a href="http://preaction.me/statocles">Statocles</a>-based site:</p>

                   <p><b>2019-05-19</b><br>
                     <a href="/blog/2019/05/19/new-site.html">New site engine for rexify.org</a></p><p>
                   </p><p></p><p>After months of work on a new site backend, we reached the MVP today for
our site to be switched over to a new engine: from now on, our site will be
maintained using the static site generator
<a href="http://preaction.me/statocles/">Statocles</a>.</p>


               <h2>Conferences</h2>
                 <div class="news_widget">
                    <div class="news_date">2016-06-21</div>
                    <div class="news_content"><a href="http://preaction.me/">Doug Bell (preaction)</a> from <a href="http://chicago.pm.org/">Chicago.pm</a> will give an <a href="http://www.yapcna.org/yn2016/talk/6549">Introduction to Rex</a> talk at <a href="http://www.yapcna.org/yn2016/">YAPC::NA 2016</a>.</div>
                 </div>

               <h2>Need Help?</h2>
               <p>Rex is a pure open source project, you can find community support in the following places:</p>
               <ul>
                  <li>IRC: <a href="irc://irc.freenode.net/rex">#rex on irc.freenode.net</a></li>
                  <li>Groups: <a href="https://groups.google.com/group/rex-users/">Rex Users</a></li>
                  <li>Serverfault: <a href="http://serverfault.com/questions/tagged/rex">Tag with <i>rex</i></a></li>
                  <li>Issues: <a href="https://github.com/RexOps/Rex/issues">on GitHub</a></li>
                  <li>Feature: you miss a <a href="/feature.html">feature</a>?</li>
               </ul>
               <p><a href="/support/index.html">Professional support</a> is also available.</p>
            </div>
         </div> <!-- widgets -->

         <div id="content_container">
            <div id="content">
                




<p>
» <a href="/index.html">Home</a>
» <a href="/docs/index.html">Docs</a>
» <a href="/docs/guides/index.html">Guides</a>
» <a href="/docs/guides/start_using__r__ex.html">Howto start using (R)?ex</a>
</p>

              
              <h1>Howto start using (R)?ex</h1>
              <p>This is a small howto showing the first steps with Rex.</p>

<h1 id="basicarchitecture">Basic Architecture</h1>

<p><img alt="Basic architecture" height="272" src="/public/images/skin/rexify.org/archi.png" style="float: right;" width="410"></p>

<p>Rex is a server orchestration tool that doesn&#39;t need an agent on the hosts you want to manage. In fact it uses ssh to execute the given commands.</p>

<p>To use Rex you don&#39;t need Perl knowledge at first. Rex uses a simple DSL to describe your servers. Indeed, it is also possible to use Rex from within your shell scripts without using perl at all.</p>

<p>In fact, if you know a little bit perl it won&#39;t hurt you.</p>

<p>The starting point of every Rex project is the so called Rexfile. You can think of this file like a Makefile. You can define tasks in this file.</p>

<p>A task is a bunch of related commands. For example installing a package, uploading the configuration file and starting the service. You can also call tasks from other tasks or create rollback scenarios if something went wrong during the execution.</p>

<h1 id="requirements">Requirements</h1>

<p>To run Rex you don&#39;t need much.</p>

<h2 id="centralmasterhost">Central Master Host</h2>

<p>You can run Rex from your workstation or on a central master host.</p>

<p>For your central Rex machine (the master) you need at least Perl 5.10.1. For the best experience we recommend using the <a href="https://www.perl.org/get.html">latest stable release of Perl</a>.</p>

<p>On this host you also need some Perl modules installed. If you&#39;re using the packages provided by your OS distribution, or you install Rex from CPAN, then those dependencies will be installed automatically.</p>

<p>You can find information on the <a href="/get/index.html">Get Rex</a> page about how to install Rex itself.</p>

<h2 id="managedhosts">Managed Hosts</h2>

<p>On the systems you want to manage you need only two things: a Perl 5 interpreter, and a valid SSH account.</p>

<p>Rex only uses core Perl modules on the remote hosts, but some operating systems (e.g. RHEL/CentOS 7, Fedora 21) might not supply all of them out of the box. In this case you might need to install them first (currently this means the Digest::MD5 module).</p>

<p>You can install this module with <code>yum install perl-Digest-MD5</code>.</p>

<p>If you want to run administrative tasks on the remote machines, you obviously would need root or sudo access on them.</p>

<h1 id="creatingarexfile">Creating a Rexfile</h1>

<p>First we need to create a new folder to store your Rexfile in it.</p>

<pre><code>$ mkdir -p projects/my-first-rex-project
</code></pre>

<p>Now change into this directory and create a file called Rexfile with the following contents:</p>

<pre><code class="hljs">⁠<span class="hljs-keyword">use</span> Rex -feature =&gt; [&#39;<span class="hljs-string">1.3</span>&#39;];
⁠
⁠user &quot;<span class="hljs-string">my-user</span>&quot;;
⁠password &quot;<span class="hljs-string">my-password</span>&quot;;
⁠
⁠group myservers =&gt; &quot;<span class="hljs-string">mywebserver</span>&quot;, &quot;<span class="hljs-string">mymailserver</span>&quot;, &quot;<span class="hljs-string">myfileserver</span>&quot;;
⁠
⁠desc &quot;<span class="hljs-string">Get the uptime of all servers</span>&quot;;
⁠task &quot;<span class="hljs-string">uptime</span>&quot;,
⁠  group =&gt; &quot;<span class="hljs-string">myservers</span>&quot;,
⁠  <span class="hljs-keyword">sub </span>{
⁠  <span class="hljs-keyword">my</span> <span class="hljs-type">$output</span> = run &quot;<span class="hljs-string">uptime</span>&quot;;
⁠  say <span class="hljs-type">$output</span>;
⁠  };</code></pre>

<p>This Example will login as my-user with the password my-password on all the servers in the group myservers and run the command &quot;uptime&quot;.</p>

<p>The special first line <code>use Rex -feature =&gt; [&#39;1.3&#39;];</code> enables all features that are available for version 1.3. If you want to know more about feature flags, please read this page.</p>

<p>Change into the directory where you just created the Rexfile (in a terminal).</p>

<pre><code>$ cd projects/my-first-rex-project
$ rex uptime
</code></pre>

<h2 id="addingasecondtask">Adding a second task</h2>

<p>To add a second task, just add the next lines to your Rexfile.</p>

<pre><code class="hljs">⁠desc &quot;<span class="hljs-string">Start Apache Service</span>&quot;;
⁠task &quot;<span class="hljs-string">start_apache</span>&quot;,
⁠  group =&gt; &quot;<span class="hljs-string">myservers</span>&quot;,
⁠  <span class="hljs-keyword">sub </span>{
⁠  service &quot;<span class="hljs-string">apache2</span>&quot; =&gt; &quot;<span class="hljs-string">start</span>&quot;;
⁠  };</code></pre>

<p>This task will start the service apache2 on all the servers in the myservers group.</p>

<h2 id="displayalltasksinarexfile">Display all tasks in a Rexfile</h2>

<p>If you want to display all tasks in your Rexfile use the following command.</p>

<pre><code>$ rex -T
Tasks
  start_apache                   Start Apache Service
  uptime                         Get the uptime of all servers
Server Groups
  myservers                       mywebserver, mymailserver, myfileserver
</code></pre>

<h2 id="authentication">Authentication</h2>

<p>In the previous example we showed you how you can login with a user and a password. But it is also possible to use key authentication.</p>

<p>To use key authentication just define your private and public key inside the Rexfile.</p>

<pre><code class="hljs">⁠user &quot;<span class="hljs-string">my-user</span>&quot;;
⁠private_key &quot;<span class="hljs-string">/home/user/.ssh/id_rsa</span>&quot;;
⁠public_key &quot;<span class="hljs-string">/home/user/.ssh/id_rsa.pub</span>&quot;;
⁠key_auth;</code></pre>

<p>It is also possible to use your keys with a passphrase. Just add it to your Rexfile.</p>

<pre><code class="hljs">⁠user &quot;<span class="hljs-string">my-user</span>&quot;;
⁠private_key &quot;<span class="hljs-string">/home/user/.ssh/id_rsa</span>&quot;;
⁠public_key &quot;<span class="hljs-string">/home/user/.ssh/id_rsa.pub</span>&quot;;
⁠password &quot;<span class="hljs-string">key-passphrase</span>&quot;;
⁠key_auth;</code></pre>

<p>If you don&#39;t want to add your passphrase to the Rexfile you can also use ssh-agent. Rex will automatically use it when it is running. Just remove the line <code>key_auth;</code>.</p>

<h2 id="managingservices">Managing Services</h2>

<p>If you want to manage services you often need to upload a configuration file and to register the service to start at boot time.</p>

<p>In this example you will learn how to install and configure ntp. You can adapt this example to every other service easily.</p>

<pre><code class="hljs">⁠<span class="hljs-comment"># Rexfile</span><span class="hljs-comment">
⁠</span><span class="hljs-keyword">use</span> Rex -feature =&gt; [&#39;<span class="hljs-string">1.3</span>&#39;];
⁠
⁠user &quot;<span class="hljs-string">root</span>&quot;;
⁠private_key &quot;<span class="hljs-string">/root/.ssh/id_rsa</span>&quot;;
⁠public_key &quot;<span class="hljs-string">/root/.ssh/id_rsa.pub</span>&quot;;
⁠
⁠group all_servers =&gt; &quot;<span class="hljs-string">srv[001..150]</span>&quot;;
⁠
⁠task &quot;<span class="hljs-string">setup_ntp</span>&quot;,
⁠  group =&gt; &quot;<span class="hljs-string">all_servers</span>&quot;,
⁠  <span class="hljs-keyword">sub </span>{
⁠  <span class="hljs-comment"># first we will install the package</span><span class="hljs-comment">
⁠</span>  pkg &quot;<span class="hljs-string">ntpd</span>&quot;, ensure =&gt; &quot;<span class="hljs-string">present</span>&quot;;
⁠
⁠  <span class="hljs-comment"># then we will upload a configuration file.</span><span class="hljs-comment">
⁠</span>  <span class="hljs-comment"># the configuration file is located in a subdirectory files/etc.</span><span class="hljs-comment">
⁠</span>  file &quot;<span class="hljs-string">/etc/ntp.conf</span>&quot;,
⁠    source    =&gt; &quot;<span class="hljs-string">files/etc/ntp.conf</span>&quot;,
⁠    on_change =&gt; <span class="hljs-keyword">sub </span>{
⁠
⁠    <span class="hljs-comment"># we define a on_change hook, so that the ntpd server gets restarted if the file is modified.</span><span class="hljs-comment">
⁠</span>    service ntpd =&gt; &quot;<span class="hljs-string">restart</span>&quot;;
⁠    };
⁠
⁠  <span class="hljs-comment"># now we register the service to start at boot time.</span><span class="hljs-comment">
⁠</span>  service &quot;<span class="hljs-string">ntpd</span>&quot;, ensure =&gt; &quot;<span class="hljs-string">started</span>&quot;;
⁠  };</code></pre>

<p>That&#39;s all.</p>

<p>This task will now install ntpd on your servers, upload a configuration file and start the service.</p>

<p>You don&#39;t need to worry about the order of your commands. Rex will always executes your commands from top to bottom.</p>

<p>To read more about <a href="../../docs/guides/using_modules_and_templates.html">using modules and templates please read this howto</a>.</p>



            </div>
         </div> <!-- content -->

       <!-- page -->


   <div class="clearfix"></div>
   <div class="bottom_bar">
      <a href="https://groups.google.com/group/rex-users/">Google Group</a> / <a href="http://twitter.com/RexOps">Twitter</a> / <a href="https://github.com/RexOps/Rex">GitHub</a> / <a href="http://www.freelists.org/list/rex-users">Mailinglist</a> / <a href="irc://irc.freenode.net/rex">irc.freenode.net #rex</a>   -.ô.-   <a href="http://www.disclaimer.de/disclaimer.htm" target="_blank">Disclaimer</a>
   </div>

   </body>

</html>
