<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta content="text/html; charset=utf-8" http-equiv="content-type">

      <title>Manage your Amazon EC2 instances</title>

      <meta content="width=1024, initial-scale=0.5" name="viewport">
      <link href="/public/images/skin/rexify.org/favicon.png" rel="shortcut icon">
      <link href="/public/css/skin/rexify.org/hs/tomorrow.css" rel="stylesheet">
      <link charset="utf-8" href="/public/css/skin/rexify.org/bootstrap.min.css?20130325" media="screen" rel="stylesheet" type="text/css">
      <link charset="utf-8" href="/public/css/skin/rexify.org/default.css?20140412" media="screen" rel="stylesheet" type="text/css">
      <script src="/public/js/skin/rexify.org/highlight.pack.js"></script>
      <meta content="" name="description">
      <meta content="" name="keywords">

   </head>
   <body>

      <div id="page">

         <div class="top_div" id="top-div">
            <h1>(R)?ex <small>Deployment &amp; Configuration Management</small></h1>
            <div id="nav-div">
               
<div class="nav_links">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/get/index.html">Get Rex</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/care/index.html">Care</a>
      <ul class="dropdown_menu dropdown_care">
          <li><a href="/care/help__r__ex.html">Help (R)?ex</a></li>
          <li><a href="/care/help_people_in_need.html">Help people</a></li>
      </ul>
    </li>
    <li><a href="/support/index.html">Support</a></li>
    <li>
      <b class="arrow_box"></b>
      <a class="dropdown_link" href="/docs/index.html">Docs</a>
      <ul class="dropdown_menu dropdown_docs">
          <li><a href="/docs/faq/index.html">FAQ</a></li>
          <li><a href="/docs/guides/index.html">Guides</a></li>
          <li><a href="/docs/rex_book/index.html">Rex Book (work in progress)</a></li>
          <li><a href="/docs/release_notes/index.html">Release notes</a></li>
            <li class="divider"></li>
          <li><a href="https://metacpan.org/release/Rex">API</a></li>
      </ul>
    </li>
  </ul>
</div>

            </div>
            </div>
         </div>

         <div id="widgets_container">
            <div id="widgets">
               <h2>News</h2>
                   <p><b>2019-07-02</b><br>
                     <a href="/blog/2019/07/02/deprecating_official_rex_packages.html">Deprecating official Rex packages</a></p><p>
                   </p><p></p><p>As part of our efforts to simplify maintenance around RexOps projects, we have decided to stop building Rex packages on our side. We recommend relying on OS packages maintained by the various distributions in their respective upstream repositories, or to install Rex from CPAN.</p>

                   <p><b>2019-06-09</b><br>
                     <a href="/blog/2019/06/09/site-update.html">Post-migration updates &amp; clean-up</a></p><p>
                   </p><p></p><p>Over the course of the past weeks many clean-ups have been
done, reaping the benefits provided by our new
<a href="http://preaction.me/statocles">Statocles</a>-based site:</p>

                   <p><b>2019-05-19</b><br>
                     <a href="/blog/2019/05/19/new-site.html">New site engine for rexify.org</a></p><p>
                   </p><p></p><p>After months of work on a new site backend, we reached the MVP today for
our site to be switched over to a new engine: from now on, our site will be
maintained using the static site generator
<a href="http://preaction.me/statocles/">Statocles</a>.</p>


               <h2>Conferences</h2>
                 <div class="news_widget">
                    <div class="news_date">2016-06-21</div>
                    <div class="news_content"><a href="http://preaction.me/">Doug Bell (preaction)</a> from <a href="http://chicago.pm.org/">Chicago.pm</a> will give an <a href="http://www.yapcna.org/yn2016/talk/6549">Introduction to Rex</a> talk at <a href="http://www.yapcna.org/yn2016/">YAPC::NA 2016</a>.</div>
                 </div>

               <h2>Need Help?</h2>
               <p>Rex is a pure open source project, you can find community support in the following places:</p>
               <ul>
                  <li>IRC: <a href="irc://irc.freenode.net/rex">#rex on irc.freenode.net</a></li>
                  <li>Groups: <a href="https://groups.google.com/group/rex-users/">Rex Users</a></li>
                  <li>Serverfault: <a href="http://serverfault.com/questions/tagged/rex">Tag with <i>rex</i></a></li>
                  <li>Issues: <a href="https://github.com/RexOps/Rex/issues">on GitHub</a></li>
                  <li>Feature: you miss a <a href="/feature.html">feature</a>?</li>
               </ul>
               <p><a href="/support/index.html">Professional support</a> is also available.</p>
            </div>
         </div> <!-- widgets -->

         <div id="content_container">
            <div id="content">
              




<p>
» <a href="/index.html">Home</a>
» <a href="/docs/index.html">Docs</a>
» <a href="/docs/guides/index.html">Guides</a>
» <a href="/docs/guides/cloud_management/index.html">Cloud management</a>
» <a href="/docs/guides/cloud_management/manage_your_amazon_ec2_instances.html">Manage your Amazon EC2 instances</a>
</p>

              
              <h1>Manage your Amazon EC2 instances</h1>
              <h2 id="startingpoint">Starting Point</h2>

<p>In this howto i will show you how to create and manage your Amazon EC2 instances.</p>

<h2 id="preparation">Preparation</h2>

<ul>
<li>Register at http://aws.amazon.com/de/</li>
<li>Get your AccessKey and your Secret AccessKey</li>
<li>Create a key-pair and save it to your disk</li>
<li>Create a public key out of your just downloaded private key. You can do this with ssh-keygen -y -f your-aws-private-key.pem</li>
</ul>

<h2 id="creatingarexfile">Creating a Rexfile</h2>

<p>At first you need to create a Rexfile in a directory of your choice.</p>

<pre><code>$ mkdir amazon
$ cd amazon
$ touch Rexfile
</code></pre>

<p>Open the Rexfile in your preferred editor.</p>

<p>Insert the following code in your new Rexfile.</p>

<pre><code>use Rex -feature =&gt; [&#39;1.0&#39;];
use Rex::Commands::Cloud;

user &quot;root&quot;;
public_key &quot;/path/to/your/just/created/amazon-public.key&quot;;
private_key &quot;/path/to/your/just/downloaded/amazon-private-key.pem&quot;;

my $access_key = &quot;your-access-key&quot;;
my $secret_access_key = &quot;your-secret-key&quot;;

cloud_service &quot;Amazon&quot;;
cloud_auth &quot;$access_key&quot;, &quot;$secret_access_key&quot;;
cloud_region &quot;ec2.eu-west-1.amazonaws.com&quot;;

task &quot;create&quot;, sub {
   cloud_instance create =&gt; { 
            image_id =&gt; &quot;ami-02103876&quot;,
            name     =&gt; &quot;static01&quot;,
            key      =&gt; &quot;dev-test&quot;,
         };
};
</code></pre>

<p>This task create a new Amazon EC2 instance with no EBS block device.</p>

<h3 id="createaninstancewithanebsblockvolume">Create an instance with an EBS block volume</h3>

<p>Sometimes you need an instance with a persistent storage volume. To achieve this your can use an EBS block volume.</p>

<pre><code>task &quot;create&quot;, sub {
   my $vol_id = cloud_volume create =&gt; { size =&gt; 1, zone =&gt; &quot;eu-west-1a&quot;, };
   cloud_instance create =&gt; { 
            image_id =&gt; &quot;ami-02103876&quot;,
            name     =&gt; &quot;static01&quot;,
            key      =&gt; &quot;dev-test&quot;,
            volume   =&gt; $vol_id,
            zone     =&gt; &quot;eu-west-1a&quot;,
         };
};
</code></pre>

<h3 id="listingregionsandzones">Listing Regions and zones</h3>

<p>To get a list of all regions and zone you can use the following functions.</p>

<pre><code>task &quot;list&quot;, sub {
   print Dumper get_cloud_regions;
   print Dumper get_cloud_availability_zones;
};
</code></pre>

<h3 id="listyourinstances">List your instances</h3>

<p>To get a list of all your instances and volumes you can use these functions.</p>

<pre><code>task &quot;list&quot;, sub {
   print Dumper cloud_instance_list;
   print Dumper cloud_volume_list;
};
</code></pre>

<h3 id="destroyyourinstancesvolumes">Destroy your instances / volumes</h3>

<p>If you don&#39;t need your instances or volumes anymore, you can just destroy them.</p>

<pre><code>task &quot;destroy&quot;, sub {
   cloud_volume delete =&gt; &quot;$volume_id&quot;;
   cloud_instance terminate =&gt; &quot;$instance_id&quot;;
};
</code></pre>

<h3 id="putallyourec2instancesinahostgroup">Put all your EC2 instances in a host group</h3>

<p>If you have many instances you can easily add them all into a hostgroup.</p>

<pre><code>group ec2 =&gt; get_cloud_instances_as_group();
</code></pre>

<h3 id="installingsomesoftwareandrunrex">Installing some Software and run Rex</h3>

<p>Now we need to add some software to our fresh EC2 instance.</p>

<pre><code>task &quot;prepare&quot;, group =&gt; &quot;ec2&quot;, sub {
   run &quot;apt-get update&quot;;
   install package =&gt; &quot;apache2&quot;;

   service apache2 =&gt; &quot;ensure&quot;, &quot;started&quot;;

   # deploy your webapp, see Rex::Apache::Deploy for more information.
   deploy &quot;my-site.tar.gz&quot;;

   # or upload some files
   file &quot;/etc/passwd&quot;,
      source =&gt; &quot;/etc/passwd&quot;;

   # do what ever you want
   use Rex::Commands::Iptables;
   close_port &quot;all&quot;;
};
</code></pre>

<p>Now you can run Rex to create the instance and prepare the system for use.</p>

<pre><code>$ rex create prepare
[2011-08-06 10:25:58] (5783) - INFO - Running task: create
[2011-08-06 10:26:38] (5783) - INFO - Running task: prepare
[2011-08-06 10:26:38] (5801) - INFO - Connecting to 46.51.135.11 (root)
[2011-08-06 10:27:14] (5801) - INFO - Installing apache2.
[2011-08-06 10:27:30] (5801) - INFO - Uploadling files/index.html -&gt; /var/www/index.html
</code></pre>



            </div>
         </div> <!-- content -->

       <!-- page -->


   <div class="clearfix"></div>
   <div class="bottom_bar">
      <a href="https://groups.google.com/group/rex-users/">Google Group</a> / <a href="http://twitter.com/RexOps">Twitter</a> / <a href="https://github.com/RexOps/Rex">GitHub</a> / <a href="http://www.freelists.org/list/rex-users">Mailinglist</a> / <a href="irc://irc.freenode.net/rex">irc.freenode.net #rex</a><span id="syntax_high" style="display: none;"> / <a href="#" id="link_syntax_high">Enable Syntax Highlighting</a></span>   -.ô.-   <a href="http://www.disclaimer.de/disclaimer.htm" target="_blank">Disclaimer</a>
   </div>

<script>
  hljs.tabReplace = '    ';
  hljs.initHighlightingOnLoad();
</script>


   </body>

</html>
