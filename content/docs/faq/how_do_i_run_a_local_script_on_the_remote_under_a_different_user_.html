<p>Given the same scenario as above, but with the additional requirement to run the script as a different user, the solution looks like below:</p>
<pre><code class="perl">use Rex::Misc::ShellBlock;<br />task "myexec", sub {<br /></code><code class="perl">  sudo {<br /></code><code class="perl">    command =&gt; sub {<br /></code><code class="perl">      shell_block template('files/script');<br /></code><code class="perl">    },<br /></code><code class="perl">    user&nbsp;&nbsp;&nbsp; =&gt; 'root'<br /></code><code class="perl">  };<br /></code><code class="perl">};</code></pre>